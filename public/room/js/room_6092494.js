function formatNumber(e,t){for(var i=e?e.toString().split("."):["0"],n=t?t.split("."):[""],a="",s=i[0],o=n[0],r=s.length-1,l=!1,c=o.length-1;c>=0;c--)switch(o.substr(c,1)){case"#":r>=0&&(a=s.substr(r--,1)+a);break;case"0":a=r>=0?s.substr(r--,1)+a:"0"+a;break;case",":l=!0,a=","+a}if(r>=0)if(l)for(var d=s.length;r>=0;r--)a=s.substr(r,1)+a,r>0&&(d-r)%3==0&&(a=","+a);else a=s.substr(0,r+1)+a;a+=".",s=i.length>1?i[1]:"",o=n.length>1?n[1]:"",r=0;for(var c=0;c<o.length;c++)switch(o.substr(c,1)){case"#":r<s.length&&(a+=s.substr(r++,1));break;case"0":a+=r<s.length?s.substr(r++,1):"0"}return a.replace(/^,+/,"").replace(/\.$/,"")}function shouhuHtml(e){var t="";return e>0&&(11>=e?t='<span class="sh-icon sh-icon1"></span>':e>=12&&519>=e?t='<span class="sh-icon sh-icon2"></span>':e>=520&&1313>=e?t='<span class="sh-icon sh-icon3"></span>':e>=1314&&(t='<span class="sh-icon sh-icon4"></span>')),t}function huya_log(){if(huya_log.debug)try{return console.log.apply(console,arguments)}catch(e){}}function muteRoomUserReq(e,t){TTP.isH5?TTP.ready(function(i){i.addTafListener("muteRoomUser",function(e){t(e),i.removeTafListener("muteRoomUser")});var n=new HUYA.MuteRoomUserReq;n.tId=i.userId,i.sendWup("liveui","muteRoomUser",$.extend(n,e))}):(TTP.on("silenceResp",function(e){t(e),TTP.off("silenceResp")}),TTP.ready(function(t){t.callAs("js2muteRoomUser",e)}))}function speakUsableTimeReq(e){TTP.isH5?TTP.ready(function(t){t.addTafListener("getRoomAuditConf",function(i){for(var n=i.vSpeakSwitchItem.value,a=0;a<n.length;a++)if(1003==n[a].iItemID)return e(n[a].iValue);t.removeTafListener("getRoomAuditConf")});var i=new HUYA.GetRoomAuditConfReq;i.tUserId=t.userId,i.lTid=hyPlayerConfig.args.chTopId,i.lSid=hyPlayerConfig.args.subChId,i.lPid=window.l_p,t.sendWup("liveui","getRoomAuditConf",i)}):(TTP.on("getRoomAuditConfRsp",function(t){for(var i=t.param.vSpeakSwitchItem.value,n=0;n<i.length;n++)if(1003==i[n].iItemID)return e(i[n].iValue);TTP.off("getRoomAuditConfRsp")}),TTP.ready(function(e){e.callAs("getRoomAuditConfReq")}))}function textPendantParse(e){var t="";return t=e.iColor>0?'<span style="color:#'+fontColorParse(e.iColor)+'">'+e.sText+"</span>":"<span>"+e.sText+"</span>"}function fontColorParse(e){if(e>0){var t=e.toString(16);if(t.length<6){for(var i=6-t.length,n="",a=0;i>a;a++)n+="0";e=n+t}else e=t}else e=0;return e}var isSupportAnimation=function(){var e=document.createElement("div"),t=["animation","MozAnimation","WebkitAnimation","MsAnimation","OAnimation"];for(var i in t)if(void 0!==e.style[t[i]])return!0;return $("body").addClass("no-animation"),!1}();huya_log.debug=!0;var huyaLiveRoomMessenger=function(){function e(e){if("string"==typeof e)try{e=$.parseJSON(e)}catch(i){}if($.isPlainObject(e)){var n=t[e.code];n&&n.fire(e.data)}else try{console.log("'data' must be a json!")}catch(i){}}var t={};if("postMessage"in window)"addEventListener"in document?window.addEventListener("message",function(t){/huya\.com$/.test(t.origin)&&e.call(this,t.data)},!1):"attachEvent"in document&&window.attachEvent("onmessage",function(t){/huya\.com$/.test(t.origin)&&e.call(this,t.data)});else{var i=window.navigator.onmessage;window.navigator.onmessage=function(){e.call(this,arguments),"function"==typeof i&&i.call(this,arguments)}}return{on:function(e,i){return t[e]||(t[e]=$.Callbacks()),t[e].add(i),this},off:function(e,i){var n=arguments.length;if(0===n)for(var a in t)t.hasOwnProperty(a)&&t[a].empty();else{var s=t[e];s&&(1===n?s.empty():s.remove(i))}return this}}}(),huya_layer_n_dialog=function(){function e(i){if(!(this instanceof e))return new e(i);$.isPlainObject(i)||(i={view:i}),$.extend(this,{view:"<div></div>",width:"",height:"",zIndex:999,lock:!0,container:document.body},$.layerSettings,i),this.lock&&(this.overlay=t(i)),this.view=$(this.view).eq(0),this.container=$(this.container).eq(0);var n=this.container[0];n&&n!==window&&n!==document||(this.container=$(document.body)),this.render()}function t(t){t=t||{};var i,n,a=$("<div></div>").css({opacity:t.opacity||.5,backgroundColor:t.color||"#000",zoom:1}),s=$(t.container);return s[0]&&s[0]!==window&&s[0]!==document&&s[0]!==document.body?(i=s.innerWidth(),n=s.innerHeight()):i=n="100%",e({view:a,width:i,height:n,zIndex:t.zIndex,container:t.container,lock:!1})}function i(e){return new i.prototype.init(e)}var n=$.browser.msie?parseInt($.browser.version,10):!1;return e.prototype={render:function(){this.view.css("position","absolute"),this.view.css("zIndex",this.zIndex),this.view.width(this.width),this.view.height(this.height),this.view.appendTo(this.container),this.open(),this.center()},center:function(){function e(){t.css({position:"absolute",left:a.scrollLeft()+(a.width()-t.outerWidth())/2,top:a.scrollTop()+(a.height()-t.outerHeight())/2})}function e(){t.css({position:"fixed",left:(a.width()-t.outerWidth())/2,top:(a.height()-t.outerHeight())/2})}var t=this.view,i=this.container;if(i[0]===document.body){var a=$(window);6==n?(i.css("position","relative"),e(),a.resize(e).scroll(e)):(e(),a.resize(e))}else i.css("position","relative"),t.css({position:"absolute",left:(i.innerWidth()-t.outerWidth())/2,top:(i.innerHeight()-t.outerHeight())/2})},open:function(){this.view.show(),this.lock&&this.overlay.open()},hide:function(){this.view.hide(),this.lock&&this.overlay.hide()},close:function(){this.view.remove(),this.lock&&this.overlay.close()}},i.loading=function(e,t){return i({title:e,customClass:"loadingDlg",content:'<div class="loadingDlg-cont"><i></i></div>',buttons:[],zIndex:t})},i.alert=function(e,t,n,a){return i({title:e,customClass:"alertDlg",content:'<div class="alertDlg-cont"><div class="alertDlg-txt">'+t+"</div></div>",buttons:n,zIndex:a})},i.suc=function(e,t,n,a){return i({title:e,customClass:"alertDlg",content:'<div class="alertDlg-cont"><i class="icon-suc"></i><p class="alertDlg-msg">'+t+"</p></div>",buttons:n,zIndex:a})},i.err=function(e,t,n,a){return i({title:e,customClass:"alertDlg",content:'<div class="alertDlg-cont"><i class="icon-err"></i><p class="alertDlg-msg">'+t+"</p></div>",buttons:n,zIndex:a})},i.tip=function(e,t,n,a){return i({title:e,customClass:"alertDlg",content:'<div class="alertDlg-cont"><i class="icon-tip"></i><p class="alertDlg-msg">'+t+"</p></div>",buttons:n,zIndex:a})},i.prototype={init:function(t){$.extend(this,{title:"title",content:"",customClass:"",init:function(){},close:function(){},buttons:[{type:0,name:"\u786e\u5b9a",click:function(){},close:!0}]},t);for(var i=0,n=this.buttons.length;n>i;i++)this.buttons[i]=$.extend({name:"button",click:function(){},close:!0},this.buttons[i]);this.closeCallback=this.close,delete this.close,this.state=1,this.create(),this.layer=e({view:this.view,width:this.width,height:this.height,zIndex:this.zIndex,lock:this.lock,container:this.container}),this.lock&&(this.overlay=this.layer.overlay),$.isFunction(this.init)&&this.init()},create:function(){for(var e=this,t="",i=[],n=null,a=null,s=0,o=this.buttons.length;o>s;s++)n=this.buttons[s],function(t){a=$('<a class="dlg-btn" href="#"></a>').text(t.name).addClass(["","dlg-btn-orange","dlg-btn-gray"][t.type]).click(function(i){i.preventDefault(),$.isFunction(t.click)&&t.click.apply(e,arguments),t.close&&e.close()})}(n),i.push(a[0]);this.buttons=$(i),t=['<div class="dlg">','<div class="dlg-hd">','<h5 class="dlg-tit"></h5>',"</div>",'<div class="dlg-bd"></div>','<div class="dlg-ft"></div>','<a class="dlg-close" title="\u5173\u95ed" href="#">','<i class="dlg-close-t"></i>','<i class="dlg-close-r"></i>','<i class="dlg-close-b"></i>','<i class="dlg-close-l"></i>',"</a>","</div>"].join(""),this.view=$(t).addClass(this.customClass),this.content=$(this.content),""!==this.title?this.view.find(".dlg-tit").html(this.title):this.view.addClass("acephalousDlg"),this.view.find(".dlg-bd").append(this.content),this.buttons.length?this.view.find(".dlg-ft").append(this.buttons):this.view.find(".dlg-ft").remove(),this.view.find(".dlg-close").click(function(t){t.preventDefault(),e.close()})},open:function(){this.state<=1||(this.layer.open(),this.state=1)},hide:function(){0!==this.state&&2!==this.state&&(this.layer.hide(),this.state=2)},close:function(){0!==this.state&&(this.layer.close(),this.state=0,$.isFunction(this.closeCallback)&&this.closeCallback())}},i.prototype.init.prototype=i.prototype,{layer:e,dialog:i}}(),huya_layer=huya_layer_n_dialog.layer,huya_dialog=huya_layer_n_dialog.dialog;$(function(){var e=!1;$("#liveRoomObj").on("mouseenter",function(){e=!0}).on("mouseleave",function(){e=!1});var t=window.hyPlayerConfig.liveCompatibleFlag;$(document).on("mousewheel",function(i,n){e&&1==(1&t)&&(1==n?TTP.ready(function(){TTP.call("onMouseWheel360",-1)}):-1==n&&TTP.ready(function(){TTP.call("onMouseWheel360",1)}),i.preventDefault())})}),!function(e){function t(e){return"function"==typeof e}function i(e){return"string"==typeof e}function n(e){var n=new s,c=$.extend({type:r,useHls:!1},e),d=c.type,u=d===o,f=d===r;u?l[d](c.useHls,function(){!function(){var e=hyPlayerConfig.args.chTopId,t=hyPlayerConfig.args.subChId,i=hyPlayerConfig.WEBYYFROM,n=hyPlayerConfig.iSourceType,a=hyPlayerConfig.screenType,s=hyPlayerConfig.liveRoomGid,o=hyPlayerConfig.vappid;TT.isProd||(o=10060),"2"==n&&(o=10507);var r={chTopId:e,subChId:t,eu:window.l_p,rso:parseQueryString(location.href).rso||"",rso_desc:parseQueryString(location.href).rso_desc||"",from:i,vappid:o,gameId:s,screenType:a,furl:encodeURIComponent(document.referrer),ref:window.HUYA_UTIL&&HUYA_UTIL.getCookieVal("ya_eid"),iSourceType:n,avatarImg:encodeURIComponent(liveRoomConfig.avatarImg)};0==e&&0==t&&1==window.REPLAY&&$.extend(r,{replay:1,isEu:!1,doJoin:0}),window.h5loadTime=(new Date).getTime(),$("#liveRoomObj").html('<div id="videoContainer" style="position: relative;"></div>');var l=new VPlayer($.extend({idDom:"#videoContainer",register:function(e){e.on("gamelivePubTextInitComplete",function(){TT.emit("PLAYER_READY",l),e.off("gamelivePubTextInitComplete")}),TT.emit("PLAYER_EVENT_READY",e)}},r))}()}):f&&l[d](function(){!function(){function e(e){var t=this;$("#liveRoomObj").html('<div id="flashRoomObj"></div>'),$.extend(!0,this,e),window.initComplete=function(){t.ready()},this.load()}var t=hyPlayerConfig.args.chTopId,i=hyPlayerConfig.args.subChId,n=hyPlayerConfig.WEBYYFROM,a=hyPlayerConfig.WEBYYSWF,s=(hyPlayerConfig.WEBYYHOST,hyPlayerConfig.iSourceType),o=hyPlayerConfig.screenType,r=hyPlayerConfig.liveRoomGid,l=hyPlayerConfig.vappid,c=hyPlayerConfig.assets.flash_url;"2"==s&&(l=10507),window.jsTime=(new Date).getTime();var d={topSid:t,subSid:i,eu:window.l_p,type:a,_yyAuth:"12",rso:parseQueryString(location.href).rso||"",rso_desc:parseQueryString(location.href).rso_desc||"",from:n,vappid:l,gameId:r,furl:encodeURIComponent(document.referrer),referer:encodeURIComponent(location.href),ref:window.HUYA_UTIL&&HUYA_UTIL.getCookieVal("ya_eid"),pageFull:1,iSourceType:s,screenType:o,normalpub:1,avatarImg:encodeURIComponent(liveRoomConfig.avatarImg)};0==t&&0==i&&1==window.REPLAY&&$.extend(d,{replay:1,isEu:!1,doJoin:0}),e.prototype={swfPath:"",swfVs:"10.1",swfvar:null,id:"flashRoomObj",swfSetting:{quality:"high",bgcolor:"#000000",allowScriptAccess:"always",allowFullScreen:"true",allowFullScreenInteractive:"true",wmode:"opaque",menu:"false"},type:"flash",load:function(){var e=this;return window.swfobject&&swfobject.hasFlashPlayerVersion(e.swfVs)?(swfobject.embedSWF(e.swfPath,e.id,"100%","100%",e.swfVs,null,e.swfvar,e.swfSetting,{name:e.id},huyacreateObject,huyaflashCallback),this):this},ready:function(){var e=this;e.getMovie().callAs("addJsKey",!0),TT.emit("PLAYER_EVENT_READY",e.getMovie()),TT.emit("PLAYER_READY",e.getMovie())},getMovie:function(){var e;return function(){return e||(e=$.browser.msie?window[this.id]:document[this.id])}}()},new e({swfPath:c,swfvar:d})}()}),n.on=function(){var e=n.on,s=$.Deferred();TT.on("PLAYER_EVENT_READY",function(e,t){s.resolve(t)},!0);var o={};return function(r,l){return i(r)&&t(l)?(o[r]||(o[r]=!0,s.done(function(e){function t(){n.emit.apply(n,[r].concat(a.call(arguments)))}if(u)e.on(r,t);else if(f){var i="TT_PLAYER_FLASH_EVENT_LISTENER_"+r+"_"+Math.floor(1e10*Math.random());window[i]=function(){var e=this,i=arguments;try{t.apply(e,i)}catch(n){TT.log(n)}};try{e.registerCallBack(r,i)}catch(s){TT.log("flash\u64ad\u653e\u5668\u4e8b\u4ef6\u76d1\u542c\u5931\u8d25\uff01")}}})),void e.apply(n,arguments)):this}}();var p=!1,h=null,m=function(){var e=$.Deferred();return TT.on("PLAYER_READY",function(t,i){p=!0,h=i;try{e.resolveWith(n,[h])}catch(a){TT.log(a)}},!0),function(t){return e.done(t),p}}(),g=function(e,n){if(p&&i(e)){var a;return u?t(h[e])&&(a=h[e](n)):f&&(a=h.callAs(e,n)),a}},v=function(){var e;return function(){if(!e){var t=g("getMyInfo");t&&(u?e={uid:t.lUid,nick:t.sNick}:f&&(e={uid:t.uid,nick:t.nickname}))}return e}}();return $.extend(n,{type:d,isH5:u,isFlash:f,ready:m,call:g,getMyInfo:v}),n}var a=Array.prototype.slice,s=function(){function e(){function e(){for(l=-1;++l<r.length;)r[l].apply(this,arguments);return this}function t(t,i){return e.apply(t,i)}function i(e){return s(e)&&r.push(e),this}function n(e){if(!s(e))return this;for(var t=0;(t=a.call(r,e,t))>-1;)r.splice(t,1),l>=t&&l--;return this}function o(){return r=[],this}var r=[],l=-1;return{add:i,remove:n,empty:o,fire:e,fireWith:t}}function t(){function t(t,i,n){if(!o(t)||!s(i))return this;l[t]||(l[t]={fired:!1,data:null,callbacks:new e});var a=l[t];return a.callbacks.add(i),n&&a.fired&&a.callbacks.fireWith(this,a.data),this}function i(t){if(!o(t))return this;l[t]||(l[t]={fired:!1,data:null,callbacks:new e});var i=l[t];return i.fired=!0,i.data=n.call(arguments,1),i.callbacks.fireWith(this,i.data),this}function a(e,t){var i=arguments.length;if(0===i)for(var n in l)l.hasOwnProperty(n)&&l[n].callbacks.empty();else if(o(e)){var a=l[e];a&&(1===i?a.callbacks.empty():s(t)&&a.callbacks.remove(t))}return this}function r(e,i,n){if(!o(e)||!s(i))return this;var r=function(){i.apply(this,arguments),a(e,r)};t(e,r,n)}var l={};return{on:t,one:r,off:a,emit:i}}var i=[],n=i.slice,a=i.indexOf||function(e){for(var t=0,i=this.length;i>t;t++)if(this[t]===e)return t;return-1},s=function(e){return"function"==typeof e},o=function(e){return"string"==typeof e};return t.Callbacks=e,t}(),o="H5",r="FLASH",l={};!function(){function e(e){var t;return function(){return t||(t=e.apply(this,arguments))}}function t(e,t){function i(){s.onload=s.onreadystatechange=null,s=null,"function"==typeof t&&t()}var n=document,a=n.head||n.getElementsByTagName("head")[0]||n.documentElement,s=n.createElement("script");"onload"in s?s.onload=i:s.onreadystatechange=function(){/loaded|complete/.test(s.readyState)&&i()},s.charset="utf-8",s.type="text/javascript",s.async=!0,s.src=e,a.appendChild(s)}function i(i){return e(function(){var e=$.Deferred();return t(i,function(){e.resolve()}),function(t){e.done(t)}})}var n=i(hyPlayerConfig.assets.vplayer_js),a=i(hyPlayerConfig.assets.h5_sdk_js),s=i(hyPlayerConfig.assets.h5_sdk_hls_js),c=i(hyPlayerConfig.assets.vplayer_taf_js),d=e(function(){var e=document.createElement("link");return e.rel="stylesheet",e.href=hyPlayerConfig.assets.vplayer_css,document.getElementsByTagName("head")[0].appendChild(e),!0}),u=e(function(){return!function(){var e={send:function(e){var t=new Image;t.src=e,setTimeout(function(){t=null},200)},getCookie:function(e){var t,i=new RegExp("(^| )"+e+"=([^;]*)(;|$)");return(t=document.cookie.match(i))?unescape(t[2]):null},setCookie:function(e,t,i,n,a){var s=encodeURIComponent(e)+"="+encodeURIComponent(t)+"; domain="+i+"; path="+n;a>0&&(s=s+"; expires="+a.toGMTString()),document.cookie=s},removeCookie:function(e){var t=encodeURIComponent(e)+"=";t+="; expires="+new Date(0)+"; path=/;domain="+TT.domainForWriteCookie,document.cookie=t}},t=function(e){var t=[];for(h in e)e.hasOwnProperty(h)&&t.push(encodeURIComponent(h)+"="+(void 0===e[h]||null===e[h]?"":encodeURIComponent(e[h])));return t.join("&")};window.h5VideoloadTime=function(){if("undefined"!=typeof performance&&"undefined"!=typeof flashTime&&"undefined"!=typeof reportPageView&&"undefined"!=typeof h5loadTime){var i=window.performance.timing,n=(new Date).getTime(),a={act:window.REPLAY?"webhuyah5performsreplay":"webhuyah5performs",time:parseInt(1*new Date/1e3),uid:e.getCookie("yyuid"),firstByteTime:i.responseStart-i.domainLookupStart,resourcesTime:h5loadTime-flashTime,videoTime:n-h5loadTime,firstScreenTime:n-flashTime,pageview:reportPageView};e.send("http://ylog.hiido.com/c.gif?"+t(a))}},window.h5PlayerOnload=function(){try{e.send("http://ylog.hiido.com/c.gif?"+t({act:"h5playeronload",time:parseInt(1*new Date/1e3)}))}catch(i){}}}(window),!0});l[o]=function(e,t){d(),u();var i=0,o=function(){2===++i&&n()(t)};e?s()(o):a()(o),c()(o)};var f=i("http://a.dwstatic.com/huya/main/lib/swf_hiido_hiidostatic_f23ef57.js");l[r]=function(e){f()(e)}}(),n.TYPE_H5=o,n.TYPE_FLASH=r,e.TTPlayer=n}(window),function(){var e=parseQueryString(location.href),t=!!e.playerh5,i=!!e.playerflash,n=function(){var e=navigator.userAgent.toLocaleLowerCase(),t=e.match(/chrome\/([\d.]+)/);return!!(t&&parseInt(t[1],10)>=45&&-1==e.indexOf("edge"))}(),a=function(){var e=(new Date).getTime(),t=localStorage.getItem("h5ErrorTime");return t&&864e5>=e-t?!0:!1}(),s=t||!i&&hyPlayerConfig.html5&&n&&!a;window.TTP=new TTPlayer({type:s?TTPlayer.TYPE_H5:TTPlayer.TYPE_FLASH,useHls:!!window.REPLAY})}(),function(){function e(){function e(){window.ya?TTP.call("tongjiReady",{sessionId:YA.session_id.get(),mid:YA.mid.get()}):setTimeout(e,1e3)}e()}TTP.isFlash&&TTP.on("flashTongJiInit",function(){TTP.ready(e)}),TTP.isH5&&TTP.ready(e)}(),!function(e){function t(){this.initialize.apply(this,arguments)}t.prototype={version:"1.0.0",constructor:t,initialize:function(e){this.waterfall=e.waterfall,this.waterfall_list=e.waterfall_list,this.scroll_bar=e.scroll_bar,this.scroll_move=e.scroll_move,this.scroll_move_minH=e.scroll_move_minH||20,this.maintainPosition=e.maintainPosition||!1,this.scrollFn=e.scrollFn||function(){},this.scrollMoveSpeed=9,this.setRealHeight(),this._bindEvent()},_bindEvent:function(){this._moveBar(),this._mouseScroll()},scrollToTop:function(){this.waterfall.scrollTop(0)},scrollToBottom:function(e,t){this.waterfall.scrollTop(t-e)},setRealHeight:function(e){var t,i,n,a=!1;t=this.waterfall.height(),i=this.waterfall_list.height(),n=t/i,0==this.maintainPosition&&this.scrollToBottom(t,i);var s=this.waterfall.scrollTop(),o=s/(i-t);if(n>0&&1>n){var r=parseInt(n*t)<=this.scroll_move_minH?this.scroll_move_minH:parseInt(n*t),l=this.scroll_bar.height();this.maxL=l-r,this.scroll_move[0].style.display="block",this.scroll_move[0].style.height=r+"px",this.scroll_move[0].style.top=o*this.maxL+"px",o*this.maxL+r==l&&(a=!0),e&&e(a)}else this.scroll_move[0].style.display="none"},_moveBar:function(){var e,t,i=this;$(".scroll_move").on("mousedown",function(n){return e=n.pageY-parseInt($(this).css("top")),$(document).on("mousemove",function(n){return t=n.pageY-e,0>t&&(t=0),t>i.maxL&&(t=i.maxL),i.setPosition(t),!1}),$(document).on("mouseup",function(){$(document).off("mousemove").off("mouseup")}),!1})},_mouseScroll:function(){var e=this;e.waterfall.on("mousewheel",function(t,i){var n=e.scroll_move.position().top;return n=0>i?n+e.scrollMoveSpeed>e.maxL?e.maxL:n+e.scrollMoveSpeed:n-e.scrollMoveSpeed<e.scrollMoveSpeed?0:n-e.scrollMoveSpeed,e.setPosition(n),!1})},setPosition:function(e){if("block"==this.scroll_move[0].style.display){var t=parseInt(e/this.maxL*(this.waterfall_list.height()-this.waterfall.height())),i=!1;this.waterfall.scrollTop(t),this.scroll_move.css({top:e}),e==this.maxL&&(i=!0),this.scrollFn(i)}}},e.MoveScroll=t}(window),window.speakingConfig={},$(function(){function e(e){if(0!=e){var i=$(".color-item").eq(0),n="#"+e;t.COLOR[0]=n,i.css("background-color","#"+e);var e=e.toString().toLowerCase();("fff"!=e||"ffffff"!=e)&&i.removeClass("color-item1")}}var t={COLOR:{0:"#ffffff",6:"#66ff99",10:"#33ffcc",13:"#ccff66",16:"#33ffff",18:"#33ccff",20:"#ff6699",22:"#ff3333",24:"#cc0033",26:"#ff3366"},FONT_SIZE:{0:{className:1,size:4},20:{className:2,size:2}},FONT_POSITION:{0:{className:1,position:1,text:"\u6b63\u5e38"},25:{className:2,position:2,text:"\u5e95\u90e8"},35:{className:3,position:3,text:"\u9876\u90e8"}}};!function(){function t(e){if(e>0){var t=e.toString(16);if(t.length<6){for(var i=6-t.length,n="",a=0;i>a;a++)n+="0";e=n+t}else e=t}else e=0;return e}var i="",n=HUYA_UTIL.getCookieVal("yyuid");TTP.isH5?TTP.ready(function(n){n.addTafListener("sendMessage",function(n){var a=n.tNotice;i||(i=t(a.tBulletFormat.iFontColor),e(i))})}):TTP.on("onSpeakMessage",function(a){var s=a.param;if(!i&&s.tUserInfo.lUid==n)try{i=t(s.tBulletFormat.iFontColor),e(i)}catch(o){}})}();var i=100,n=0,a=-1,s=!1,o=function(e){function t(t){"function"==typeof e&&e(a=t),s=!0,setTimeout(function(){s=!1},1e4)}return s?void("function"==typeof e&&e(a)):void TTP.ready(TTP.isH5?function(e){e.addTafListener("getUserLevelInfo",function(i){t(i.tUserProfile.tUserBase.iUserLevel),e.removeTafListener("getUserLevelInfo")});var i=new HUYA.GetUserLevelInfoReq;i.tId=e.userId,e.sendWup("huyauserui","getUserLevelInfo",i)}:function(e){TTP.on("getUserLevelInfoRsp",function(e){t(e.param.tUserProfile.tUserBase.iUserLevel),TTP.off("getUserLevelInfoRsp")}),e.callAs("getUserLevelInfo")})},r={initState:!1,view:$("#J-room-color-box"),init:function(e){this.level=e,this.creatPanel()},creatPanel:function(){this.render(this.level),this.bindEvent(),this.initState=!0},render:function(){var e="",i=this;$.each(t.COLOR,function(t,a){e+=i.level<t?'<li class="color-item locked" data-level="'+t+'" style="background-color:'+a+'"></li>':n==t?'<li class="color-item current" data-level="'+t+'" style="background-color:'+a+'"></li>':'<li class="color-item" data-level="'+t+'" style="background-color:'+a+'"></li>'}),this.view.find("#J-color-list").html(e);var a=t.COLOR[0].substring(1).toLowerCase();("fff"==a||"ffffff"==a)&&this.view.find(".color-item").eq(0).addClass("color-item1")},colorParseInt:function(e){var e=e.substring(1);return parseInt(parseInt(e,16).toString(10))},levelTip:function(e,t){var i='\u9700\u8981\u864e\u7259\u7b49\u7ea7<span class="tip-mark">'+e+"\u7ea7</span>";this.tip(i,t)},tip:function(e,t){var i=t.position(),n=i.top,a=i.left,s=$('<div class="color-grade-tip common-panel-tip">'+e+"</div>");s.css({left:a,top:n-25}).appendTo(this.view)},chooseColor:function(){var e,i,a=this;this.view.on("mouseenter",".color-item",function(t){e=$(this).data("level"),t=$(this).index(),0==t&&a.tip("\u9ed8\u8ba4\u989c\u8272",$(this)),a.level<e&&a.levelTip(e,$(this))}).on("mouseleave",".color-item",function(){$(".color-grade-tip").remove()}).on("click",".color-item",function(){a.level>=e&&($(this).addClass("current").siblings().removeClass("current"),i=t.COLOR[e],n=e,a.setColor(i))})},setColor:function(e){var t=e,i=this.colorParseInt(e);speakingConfig.iFontColor=i,("#fff"==t||"#ffffff"==t)&&(t="#aeaeae"),$("#J-room-chat-color").css("background-color",t)},bindEvent:function(){this.chooseColor()}},l={init:function(e){this.level=e,this.creat()},initState:!1,view:$("#J-room-speaking-box"),creat:function(){this.render(),this.bindEvent(),this.initState=!0},render:function(){this.renderPositionPanel(),this.renderSizePanel()},renderPositionPanel:function(){var e=this.view.find(".room-select-list"),i="";$.each(t.FONT_POSITION,function(e,t){i+='<li class="room-select-item room-select-item'+t.className+'" data-level="'+e+'" data-id="'+t.position+'">',i+='<div class="room-select-pic"></div><span class="room-select-text">'+t.text+"</span>",i+="</li>"}),e.html(i).find(".room-select-item").eq(0).addClass("on")},renderSizePanel:function(){var e=this.view.find(".room-font-list"),i="";$.each(t.FONT_SIZE,function(e,t){i+='<li class="room-font-item room-font-item'+t.className+'" data-level="'+e+'" data-id="'+t.size+'"></li>'}),e.html(i).find(".room-font-item").eq(0).addClass("on")},tip:function(e,t){var i='<span class="tip-mark">'+e+"\u7ea7</span>\u89e3\u9501",n=t.position(),a=n.top,s=n.left,o=$('<div class="font-grade-tip common-panel-tip">'+i+"</div>");return o.css({left:s-10,top:a-35}).appendTo(this.view),o},setFontEvent:function(e,t){var i=this,n=0;e.on("mouseenter",function(){var e=$(this).data("level");i.level<e&&i.tip(e,$(this))}).on("mouseleave",function(){$(".font-grade-tip").remove()}).on("click",function(){var e=$(this).data("level");i.level>=e&&(n=$(this).data("id"),$(this).addClass("on").siblings().removeClass("on"),t&&t(n))})},setPosition:function(){var e=this.view.find(".room-select-item");this.setFontEvent(e,function(e){speakingConfig.iTransitionType=e})},setSize:function(){var e=this.view.find(".room-font-item");this.setFontEvent(e,function(e){speakingConfig.iFontSize=e})},bindEvent:function(){this.setPosition(),this.setSize()}};!function(){var e=null;$("#J-room-chat-color").on("mouseenter",function(){clearTimeout(e),o(function(e){-1!==e&&(r.initState?r.level!=e&&r.render(e):r.init(e),r.view.show())})}).on("mouseleave",function(){e=setTimeout(function(){r.view.hide()},i)}),r.view.on("mouseenter",function(){clearTimeout(e)}).on("mouseleave",function(){e=setTimeout(function(){r.view.hide()},i)})}(),function(){var e=null;$("#J-room-chat-font").on("mouseenter",function(){clearTimeout(e),o(function(e){-1!==e&&(l.initState?l.level=e:l.init(e),l.view.show())})}).on("mouseleave",function(){e=setTimeout(function(){l.view.hide()},i)}),l.view.on("mouseenter",function(){clearTimeout(e)}).on("mouseleave",function(){speakingTimer=setTimeout(function(){l.view.hide()},i)})}()}),function(){function e(e){var t=e.param?e.param:e;$("#watchChat_pub").css("background-image","url("+t.data.sWebPicUrl+")")}function t(){$("#watchChat_pub").css("background-image","")}TTP.isH5?TTP.ready(function(i){i.addTafListener("getScreenSkin",function(t){0==t.iRetCode&&e(t),i.removeTafListener("getScreenSkin")});var n=new HUYA.getScreenSkinReq;n.tId=i.userId,n.lPresenterUid=window.l_p,n.iTemplate=0,n.iFromType=5,i.sendWup("liveui","getScreenSkin",n),i.addTafListener("6640",e),i.addTafListener("6641",t)}):(TTP.on("showScreenSkinNotify",e),TTP.on("hideScreenSkinNotify",t))}(),function(e){function t(t){e.extend(this,t),this.init()}function i(t){e.extend(this,t)}t.prototype={chatInput:null,chatList:null,listSize:0,maxRow:100,msgQueue:[],readyFlag:!1,msgFreshRate:200,noticeHandle:null,init:function(){var t=this;TTP.isH5?TTP.ready(function(e){e.addTafListener("10041",function(e){t.onAuditorRoleChange(e)})}):TTP.on("onAuditorRoleChange",function(e){t.onAuditorRoleChange(e)}),TTP.isH5?TTP.ready(function(e){e.addTafListener("10040",function(e){t.onAuditorEnter(e)})}):TTP.on("onAuditorEnter",function(e){t.onAuditorEnter(e)}),TTP.isH5?TTP.ready(window.REPLAY?function(i){i.addTafListener("9011",function(i){try{var n=e.parseJSON(i.sMessage);i.sMessage=n.msg,t.showReplayMessage({uid:i.lSenderUid,nick:i.sSenderNickName,msg:i.sMessage})}catch(a){}TT.emit("LIVE_ROOM_MSG_NOTICE",i)}),i.addTafListener("1400",function(e){t.showReplayMessage({uid:e.tUserInfo.lUid,nick:e.tUserInfo.sNickName,msg:e.sContent}),TT.emit("LIVE_ROOM_MSG_NOTICE",e)})}:function(e){e.addTafListener("1400",function(e){t.onSpeakMessage(e),TT.emit("LIVE_ROOM_MSG_NOTICE",e)})}):TTP.on("onSpeakMessage",function(e){t.onSpeakMessage(e),TT.emit("LIVE_ROOM_MSG_NOTICE",e)});var n=t.onSpeakMessage,a=t.addPubChatMsgQueue;TT.on("playerDisplayModeChange",function(e,i){1==i||2==i?(t.onSpeakMessage=HUYA_UTIL.throttle(n,200),t.msgQueue=[],t.addPubChatMsgQueue=HUYA_UTIL.throttle(a,200)):(t.onSpeakMessage.cancel&&t.onSpeakMessage.cancel(),t.onSpeakMessage=n,t.addPubChatMsgQueue.cancel&&t.addPubChatMsgQueue.cancel(),t.addPubChatMsgQueue=a)}),TTP.ready(function(){t.ready()}),this.chatList=this.target.find(".chat-room__list"),this.chatInputConifg&&(this.chatInput=new i(this.chatInputConifg.cfg)),DUYA_SUB.subscribe("updateFansBadge",function(e,i){if("undefined"==typeof t.cacheSpeakMessage.tUserInfo)return!1;for(var n,a,s=t.cacheSpeakMessage.vDecorationPrefix.value,o=!1,r=0;r<s.length;r++)n=s[r].iAppId,a=s[r].iViewType,0==a&&10400==n&&(o=!0,s[r].vData=i);0==o&&(s[s.length]={iAppId:10400,iViewType:0,vData:i})})},ready:function(){var e=this;e.readyFlag=!0,e.initScrollbar(),e.chatInput&&e.chatInput.init()},initScrollbar:function(){this.scrollbar.obj=this.target,this.scrollbar.obj&&this.scrollbar.init()},createUserMenu:function(t,i,n){var a=this,s=e("#J_chatUserMenu");if(!s[0]){var s=['<div class="chat_user_menu" id="J_chatUserMenu">',"<ul>",'<li data-code="0"><i class="mute-icon"></i><span>\u7981\u6b62\u53d1\u8a00</span></li>','<li data-code="1"><i class="blacklist-icon"></i><span>\u5c01\u5165\u9ed1\u540d\u5355</span></li>',1==a.userTypeRelatedToHousekeeper?'<li data-code="2"><i class="xip-icon"></i><span>\u5c01\u7981IP</span></li>':"","</ul>","</div>"];s=e(s.join("")),e("body").append(s)}return s.off("click.select").on("click.select","li",function(t){t.preventDefault();var i=e(this).data("code");n(parseInt(i,10),e(this).find("span").text())}),s.css({left:t+3,top:i}).show(),s},silence:function(e,t,i,n){function a(t){try{muteRoomUserReq({lUid:e,sText:i,lPresenterUid:window.l_p,lSubcid:window.hyPlayerConfig.args.subChId,iMutedTime:t,iMutedAction:n},function(e){e=e.param?e.param:e,0==e.iRetCode?huya_dialog.suc("\u64cd\u4f5c\u6210\u529f",e.sMsg):huya_dialog.err("\u64cd\u4f5c\u5931\u8d25",e.sMsg)})}catch(a){}try{ya.reportProductEvent({eid:"click/zhibo/gp/qdjy",eid_desc:"\u70b9\u51fb/\u76f4\u64ad/\u516c\u5c4f/\u786e\u5b9a"+s})}catch(a){}}t=HUYA_UTIL.xssFilter(t);var s=0==n?"\u7981\u8a00":2==n?"\u5c01\u7981IP":"\u5c01\u7981";i=i||"",huya_dialog({title:"\u8bf7\u786e\u8ba4",width:320,content:['<div class="silence_dialog">','<p class="tit">\u4f60\u8981\u5c06 <em>\u201c'+t+"\u201d</em> "+s+"\u591a\u4e45\uff1f</p>",i?'<p class="excerpt">'+t+"\uff1a"+i+"</p>":"",'<div class="time">','<label><input type="radio" name="silence_time" value="0.5" checked /> 30\u5206\u949f</label>','<label><input type="radio" name="silence_time" value="24" /> 1\u5929</label>','<label><input type="radio" name="silence_time" value="72" /> 3\u5929</label>','<label><input type="radio" name="silence_time" value="168" /> 7\u5929</label>',"</div>","</div>"].join(""),buttons:[{name:"\u786e\u5b9a",click:function(){var e=this.view.find("input:checked").val();e&&a(60*e*60)}},{name:"\u53d6\u6d88",click:function(){}}]})},addToBlacklist:function(t,i,n){function a(e,i,a){try{muteRoomUserReq({lUid:t,sText:n,lPresenterUid:window.l_p,lSubcid:window.hyPlayerConfig.args.subChId,iMutedTime:e,iMutedAction:1,iReasonType:i,sReason:a},function(e){e=e.param?e.param:e,0==e.iRetCode?huya_dialog.suc("\u64cd\u4f5c\u6210\u529f",e.sMsg):huya_dialog.err("\u64cd\u4f5c\u5931\u8d25",e.sMsg)})}catch(s){}try{ya.reportProductEvent({eid:"click/zhibo/gp/qdfr",eid_desc:"\u70b9\u51fb/\u76f4\u64ad/\u516c\u5c4f/\u786e\u5b9a\u5c01\u5165"})}catch(s){}}i=HUYA_UTIL.xssFilter(i),n=n||"",huya_dialog({title:"\u8bf7\u786e\u8ba4",width:320,content:['<div class="silence_addToBlacklist">','<p class="tit">\u4f60\u771f\u7684\u8981\u5c06 <em>\u201c'+i+"\u201d</em> \u5c01\u5165\u9ed1\u540d\u5355\uff1f</p>",n?'<p class="excerpt">'+i+"\uff1a"+n+"</p>":"",'<div class="time">','<label><input type="radio" name="silence_time" value="0.5" checked /> 30\u5206\u949f</label>','<label><input type="radio" name="silence_time" value="24" /> 1\u5929</label>','<label><input type="radio" name="silence_time" value="72" /> 3\u5929</label>','<label><input type="radio" name="silence_time" value="168" /> 7\u5929</label>',"</div>",'<div class="cause">',"<span>\u5c01\u4eba\u7406\u7531: </span>",'<select id="J_dlgAddToBackListCause">','<option value="1">\u6076\u610f\u5237\u5c4f</option>','<option value="2">\u8c29\u9a82</option>','<option value="3">\u5237\u5e7f\u544a</option>','<option value="4">\u5176\u4ed6</option>',"</select>",'<textarea id="J_dlgAddToBackListCauseText" placeholder="30\u4e2a\u5b57\u4ee5\u5185" maxlength="30"></textarea>',"</div>",'<p class="ps">\u5907\u6ce8\uff1a\u5c01\u5165\u9ed1\u540d\u5355\u540e\uff0c\u7528\u6237\u7684\u4e00\u5207\u4e92\u52a8\u884c\u4e3a\u5c06\u88ab\u7981\u6b62\u3002</p>',"</div>"].join(""),init:function(){var t=e("#J_dlgAddToBackListCauseText");e("#J_dlgAddToBackListCause")[0].onchange=function(){4==this.value?t.show():t.hide()
}},buttons:[{name:"\u786e\u5b9a",close:!1,click:function(){var t=this.view.find("input:checked").val(),i=e("#J_dlgAddToBackListCause").val();i=parseInt(i,10);var n="",s=e("#J_dlgAddToBackListCauseText");return 4!=i||(n=s.val())?(a(60*t*60,i,n),void this.close()):void alert("\u5c01\u4eba\u7406\u7531\u4e0d\u80fd\u4e3a\u7a7a")}},{name:"\u53d6\u6d88",click:function(){}}]})},silencePower:function(t){if(0==t)return void e("body").removeClass("IMHousekeeper").off("click.silence");var i=this;e("body").addClass("IMHousekeeper").off("click.silence").on("click.silence",".J_userMenu",function(t){t.preventDefault(),i.scrollbar.lock();var n=e(this),a=n.closest("[data-id]").data("id");if(a){var s=i.createUserMenu(t.clientX+e(window).scrollLeft(),t.clientY+e(window).scrollTop(),function(e){var t=i.msgCache[a];if(t)if(0===e){i.silence(t.uid,t.nick,t.msg,0);try{ya.reportProductEvent({eid:"click/zhibo/gp/jzfy",eid_desc:"\u70b9\u51fb/\u76f4\u64ad/\u516c\u5c4f/\u7981\u8a00\u53d1\u8a00"})}catch(n){}}else if(1===e){i.addToBlacklist(t.uid,t.nick,t.msg);try{ya.reportProductEvent({eid:"click/zhibo/gp/frhmd",eid_desc:"\u70b9\u51fb/\u76f4\u64ad/\u516c\u5c4f/\u5c01\u5165\u9ed1\u540d\u5355"})}catch(n){}}else if(2===e){i.silence(t.uid,t.nick,t.msg,2);try{ya.reportProductEvent({eid:"click/zhibo/gp/fzip",eid_desc:"\u70b9\u51fb/\u76f4\u64ad/\u516c\u5c4f/\u5c01\u7981IP"})}catch(n){}}});e("body").off("click.userMenuHide").on("click.userMenuHide",function(t){e(t.target).hasClass("J_userMenu")||(e(this).off("click.userMenuHide"),s.hide())})}})},onAuditorEnter:function(e){var t=e.param?e.param.data:e,i=this;NAV_UTIL.getUserInfo()&&t.lUid!=NAV_UTIL.getUserInfo().yyID||(i.userTypeRelatedToHousekeeper=t.iUserType,(1==t.iUserType||2==t.iUserType)&&i.silencePower(!0),3==t.iUserType&&(this.chatInput.silenced=!0,this.chatInput.silencedTips=t.sSendMessageTips,this.chatInput.silencedTips_display=t.bSendMessagePopUp,i.silencedCD=setTimeout(function(){i.chatInput.silenced=!1},1e3*t.iSendMessagePopUpAmtTime)))},onAuditorRoleChange:function(e){var t=e.param?e.param.data:e,i=this;if(t.bPopUp){var n='<div class="sysMsg"><i></i><em>\u7cfb\u7edf\u6d88\u606f\uff1a</em><span>'+t.sSystemTips+"</span></div>";i.addPubChatMsgQueue("<li>"+n+"</li>")}NAV_UTIL.getUserInfo()&&t.lUid!=NAV_UTIL.getUserInfo().yyID||(i.userTypeRelatedToHousekeeper=t.iNewUserType,i.silencePower(1==t.iNewUserType||2==t.iNewUserType?!0:!1),3==t.iNewUserType?(this.chatInput.silenced=!0,this.chatInput.silencedTips=t.sSendMessageTips,this.chatInput.silencedTips_display=t.bSendMessagePopUp,i.silencedCD=setTimeout(function(){i.chatInput.silenced=!1},1e3*t.iSendMessagePopUpAmtTime)):(this.chatInput.silenced=!1,i.silencedCD&&clearTimeout(i.silencedCD)))},msgCache:{},DJBHash:function(e){if(e){var t,e=e+"",i=5381;if(e){for(var n=0,a=e.length;a>n;++n)i+=(i<<5)+e.charAt(n).charCodeAt();t=2147483647&i}return t}},xss:function(e){return"string"!=typeof e?e:e=e.replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\'/g,"&#39;").replace(/\"/g,"&quot;")},parseEmot:function(e){return e=e||"",window.huya_Emot?huya_Emot.parse(e,function(e){return'<img src="'+e.img+'" alt="'+e.code+'" />'}):e},cacheSpeakMessage:{},showReplayMessage:function(e){if(TTP.getMyInfo()&&TTP.getMyInfo().uid!=e.uid){var t=this.parseEmot(this.xss(e.msg)),i='<li><span class="msg-hd"><span class="name">'+e.nick+' : </span></span><span class="text-content">'+t+"</span></li>";this.addPubChatMsgQueue(i)}},showMessage:function(e){window.ChatTimer&&clearTimeout(ChatTimer);var t=this,i=e.tUserInfo;if("undefined"==typeof e.tUserInfo)return!1;var n="";try{n=t.xss(decodeURIComponent(e.sContent))}catch(a){n="\u89e3\u7801\u6709\u8bef"}if(n.length>t.chatInput.maxInputSize)return!1;var s,o,r,l=e.vDecorationPrefix.value,c="",d=0;if(l&&_.isArray(l))for(var u=0,f=l.length;f>u;u++)o=l[u].iAppId,s=l[u].iViewType,r=l[u].vData,0==s&&EDecorationAppType[o]&&(c+=EDecorationAppType[o](r)),1==s&&(c+=textPendantParse(r)),10200==o&&(d=r.iLevel);var p=e.vDecorationSuffix.value,h="",m="",g="",v=!1;if(p&&_.isArray(p))for(var u=0,f=p.length;f>u;u++)s=p[u].iViewType,2==s&&(g=p[u].vData.sUrl,g&&(v=!0,m=g.lastIndexOf("."),h+='<img src="'+g.slice(0,m)+"_3"+g.slice(m)+'">'));try{i.sNickName=decodeURIComponent(i.sNickName)}catch(a){i.sNickName="\u89e3\u7801\u6709\u8bef"}var T=t.getSpanHTML(i.sNickName,i.lUid),y=t.DJBHash(i.lUid+n);t.msgCache[y]={uid:i.lUid,nick:i.sNickName,msg:n};var b="";b+=0==d?'<li data-id="'+y+'">':'<li data-id="'+y+'" class="noble-speak-wrap"><div class="box-noble box-noble-level-'+d+'">',b+='<span class="msg-hd">',b+='<span class="labels">'+c+"</span>",v?(b+='<span class="name-wrap">'+T+"</span>",b+='<span class="icon-labels">'+h+'<span style="color:##3c9cfe;"> : </span></span>'):b+='<span class="name-wrap">'+T+" : </span>",b+="</span>";var w=fontColorParse(e.tFormat.iFontColor);b+=d>0?0!=w?'<span class="msg" style="color:#'+w+'">'+t.parseEmot(n)+'</span><span class="box-noble-icon"></span></div></li>':'<span></i><span class="msg">'+t.parseEmot(n)+'</span></span><span class="box-noble-icon"></span></div></li>':0!=w?'<span class="text-content" style="color:#'+w+'">'+t.parseEmot(n)+"</span></li>":'<span class="text-content">'+t.parseEmot(n)+"</span></li>",t.addPubChatMsgQueue(b)},onSpeakMessage:function(e){window.ChatTimer&&clearTimeout(ChatTimer);var t=this;e=e.param?e.param:e;var i=e.tUserInfo,n=!1;if(i&&i.lUid<0){var a=fontColorParse(e.tFormat.iFontColor);if(0!=a)var s='<li><span class="msg-hd"><span class="name-wrap"><span class="name" style="cursor: default;">'+(i.sNickName?decodeURIComponent(i.sNickName)+" : </span>":"</span>")+'</span></span><span class="text-content" style="color:#'+a+'">'+decodeURIComponent(e.sContent)+"</span></li>";else var s='<li><span class="msg-hd"><span class="name-wrap"><span class="name" style="cursor: default;">'+(i.sNickName?decodeURIComponent(i.sNickName)+" : </span>":"</span>")+'</span></span><span class="text-content">'+decodeURIComponent(e.sContent)+"</span></li>";t.addPubChatMsgQueue(s)}else"undefined"!=typeof t.cacheSpeakMessage.tUserInfo&&TTP.getMyInfo()&&TTP.getMyInfo().uid==e.tUserInfo.lUid&&(n=!0),TTP.getMyInfo()&&TTP.getMyInfo().uid==e.tUserInfo.lUid&&(t.cacheSpeakMessage=e),0==n&&t.showMessage(e)},speak:function(t){var i=this,n=hyPlayerConfig.args.chTopId,a=hyPlayerConfig.args.subChId;0==n&&0==a?window.REPLAY?TTP.ready()&&TTP.ready(function(e){if(TTP.isH5){var i=new HUYA.SendReplayMessageReq;i.tId=e.userId,i.sMessage=JSON.stringify({msg:t}),i.iGroupType=3,i.iGroupId=window.l_p,i.sSenderNickName=TTP.getMyInfo().nick,e.sendWup("liveui","sendReplayMessage",i)}else e.callAs("speakSendMessage",{lTid:n,lSid:a,sContent:t,tBulletFormat:speakingConfig})}):TTP.getMyInfo()&&(i.cacheSpeakMessage={vDecorationPrefix:{},vDecorationSuffix:{},tFormat:{iFontColor:0},tUserInfo:{lUid:TTP.getMyInfo().uid,sNickName:TTP.getMyInfo().nick}}):TTP.ready(function(i){if(TTP.isH5){var s=new HUYA.SendMessageReq;s.tUserId=i.userId,s.lTid=n,s.lSid=a,s.sContent=t,s.tBulletFormat=e.extend(s.tBulletFormat||{},speakingConfig),i.sendWup("liveui","sendMessage",s)}else i.callAs("speakSendMessage",{lTid:n,lSid:a,sContent:t,tBulletFormat:speakingConfig})}),window.REPLAY&&TTP.isH5&&TTP.ready()?i.showReplayMessage({nick:TTP.getMyInfo().nick,msg:t}):(i.cacheSpeakMessage.sContent=t,i.showMessage(i.cacheSpeakMessage))},addPubChatMsgQueue:function(e){e&&this.msgQueue.push(e),this.showChatListThrottle||(this.showChatListThrottle=HUYA_UTIL.throttle(this.showChatList,this.msgFreshRate)),this.showChatListThrottle()},_fragmentFn:function(e,t){var i,n=0,a=[],s=t.createDocumentFragment(),o=t.createElement("div");for(o.innerHTML=e,jQuery.merge(a,o.childNodes);i=a[n++];)s.appendChild(i);return s},showChatList:function(){var e=this;if(e.msgQueue.length>0){var t=e.chatList[0];t.appendChild(e._fragmentFn(e.msgQueue.join(""),document));var i=t.getElementsByTagName("li");if(e.msgQueue.length=0,!e.scrollbar.locked){for(var n=jQuery.merge([],i),a=document.createDocumentFragment(),s=i.length-e.maxRow,o=0;s>o;o++)if(n[o]&&1==n[o].nodeType){var r=n[o].getAttribute("data-id");r&&delete e.msgCache[r],a.appendChild(n[o])}a=null}e.freshPubScreenScrollbar()}},cls:function(){this.listSize=0,this.msgCache={},this.chatList.empty(),this.freshPubScreenScrollbar()},freshPubScreenScrollbar:function(){var e=this;this.scrollbar.obj&&(e.scrollbarRinitTimeout&&clearTimeout(e.scrollbarRinitTimeout),e.scrollbarRinitTimeout=setTimeout(function(){e.scrollbar.reinit()},120))},scrollbar:{api:null,obj:null,moreMsg:e("#more-msg"),isHide:!1,locked:!1,lock:function(){var e=this;this.locked=!0,this.lockBtn.addClass("locked").find("span").text("\u89e3\u9501"),this.api.maintainPosition=!0,this.api.setRealHeight(function(t){t?e.moreMsg.hide():e.moreMsg.show()}),this.autoUnlock()},unlock:function(){var e=this;this.autoUnlockTimer&&clearTimeout(this.autoUnlockTimer),this.locked=!1,this.lockBtn.removeClass("locked").find("span").text("\u9501\u5c4f"),this.api.maintainPosition=!1,this.api.setRealHeight(function(t){t?e.moreMsg.hide():e.moreMsg.show()})},autoUnlock:function(){var e=this;e.locked&&(e.autoUnlockTimer&&clearTimeout(e.autoUnlockTimer),e.autoUnlockTimer=setTimeout(function(){e.unlock()},15e3))},lockBtn:e('<p class="lockBtn"><i></i><span>\u9501\u5c4f</span></p>'),clearBtn:e('<p class="clearBtn"><i></i><span>\u6e05\u5c4f</span></p>'),reinit:function(){var e=this;this.api.maintainPosition=this.locked,this.api.setRealHeight(function(t){t?e.moreMsg.hide():e.moreMsg.show()})},init:function(){var t=this;t.api=new MoveScroll({waterfall:e("#chat-room__wrap"),waterfall_list:e("#chat-room__list"),scroll_bar:e(".scroll_bar"),scroll_move:e(".scroll_move"),scrollFn:function(e){e?(t.unlock(),t.moreMsg.hide()):(t.lock(),t.moreMsg.show())}}),t.lockBtn.on("click",function(e){e.preventDefault();var i=t.locked;i?t.unlock():t.lock();try{ya.reportProductEvent({eid:"click/zhibo/gp/"+(i?"unlock":"lock"),eid_desc:"\u70b9\u51fb/\u76f4\u64ad/\u516c\u5c4f/"+(i?"\u89e3\u9501":"\u9501\u5c4f")})}catch(e){}}),t.clearBtn.on("click",function(e){e.preventDefault(),liveRoomInstance.cls(),t.unlock();try{ya.reportProductEvent({eid:"click/zhibo/gp/cls",eid_desc:"\u70b9\u51fb/\u76f4\u64ad/\u516c\u5c4f/\u6e05\u5c4f"})}catch(e){}}),t.obj.append(t.lockBtn).append(t.clearBtn);var i=null;DUYA_SUB.subscribe("resizeWide",function(){i&&clearTimeout(i),i=setTimeout(function(){t.reinit()},100)}),DUYA_SUB.subscribe("resizereinitialise",function(){t.reinit()}),this.moreMsg.on("click",function(e){e.preventDefault(),t.unlock()})}},getSpanHTML:function(e,t){var i="";return i=t==l_u?'<span class="name J_userMenu">'+e+"</span>":'<span class="name J_userMenu">'+e+"</span>"}},window.PublicUI=t,i.prototype={sendButtonId:"",tipsId:"",maxInputSize:30,init:function(){var t=this;t.noticeClose(),e("#"+t.sendButtonId).click(function(){e(this).hasClass("enable")&&t.msgLimit(function(){t.sendMessage()})}),t.msgInputKeyDown();try{TTP.on("sendDanmuText",function(i){i&&i.param&&i.param.danmutext&&(e("#pub_msg_input").val(i.param.danmutext),t.msgLimit(function(){t.sendMessage()}))})}catch(i){}},msgInputKeyDown:function(){var e=this;e.target.bind("keydown",function(t){return 13==t.keyCode&&t.ctrlKey?(e.insertAtCursor("\n"),!0):13!=t.keyCode||t.ctrlKey?void 0:(e.msgLimit(function(){e.sendMessage()}),!1)})},msgTimer:null,disappearTimer:null,startMsg:!1,speakTime:-1,msgLimit:function(t){var i=this;if(-1==i.speakTime)t&&t(),speakUsableTimeReq(function(e){i.speakTime=e});else{var n=3,a=i.speakTime,s=e(".chat-room__bd3"),o=i.speakTime>=10?i.speakTime:" "+i.speakTime;if(i.startMsg){if(0==e(".room_msg_fast_tip").length){var r=e('<div class="room_msg_fast_tip">\u53d1\u8a00\u592a\u5feb\uff0c\u4e3b\u64ad\u90fd\u770b\u4e0d\u8fc7\u6765\u4e86\uff0c\u4f11\u606f <span class="msg_send_time">'+o+"</span> \u79d2\u518d\u53d1\u5427~</div>");s.append(r)}else e(".room_msg_fast_tip").show();clearTimeout(i.disappearTimer),i.disappearTimer=setTimeout(function(){e(".room_msg_fast_tip").hide(),clearTimeout(i.disappearTimer)},1e3*n)}else i.startMsg=!0,t&&t(),i.msgTimer||(i.msgTimer=setInterval(function(){a--;var t=a>=10?a:" "+a;e(".msg_send_time").text(t),0>=a&&(clearInterval(i.msgTimer),i.msgTimer=null,i.startMsg=!1,e(".room_msg_fast_tip").hide(),e(".msg_send_time").text(o))},1e3))}},insertAtCursor:function(e){var t=this.target[0];if(document.selection)t.focus(),sel=document.selection.createRange(),sel.text=e,sel.select();else if(t.selectionStart||"0"==t.selectionStart){t.blur();var i=t.selectionStart,n=t.selectionEnd,a=t.scrollTop;t.value=t.value.substring(0,i)+e+t.value.substring(n,t.value.length),a>0&&(t.scrollTop=a),t.focus(),t.selectionStart=i+e.length,t.selectionEnd=i+e.length}else t.value+=e,t.focus()},sendMessage:function(){var e=this,t=e.target.val(),i=a_userIsLogin,n=a_userName;return""!=n||i?e.silenced&&e.silencedTips_display?void e.noticeMe(e.silencedTips):t?t.length>e.maxInputSize?void e.noticeMe("\u8f93\u5165\u5b57\u6570\u6700\u5927\u4e0d\u80fd\u8d85\u8fc7"+e.maxInputSize):(TTP.ready(function(){liveRoomInstance.speak(t)}),window.ya&&ya.reportProductEvent({eid:"click/zhibo/sendwords",eid_desc:"\u70b9\u51fb/\u76f4\u64ad\u95f4/\u53d1\u8a00\u6309\u94ae",ayyuid:window.l_p,gameId:window.hyPlayerConfig.liveRoomGid}),e.target.val(""),void("undefined"!=typeof roomInputObj&&roomInputObj.resetAll())):void e.noticeMe("\u8bf7\u8f93\u5165\u8981\u53d1\u8a00\u7684\u5185\u5bb9\uff01"):(NAV_UTIL.login(),!1)},noticeMe:function(t){if(t){var i=this;e("#"+i.tipsId+" p").text(t),e("#"+i.tipsId).show(),setTimeout(function(){e("#"+i.tipsId).hide()},3e3)}},noticeClose:function(){e("#"+this.tipsId+" a").click(function(){e(this).parent().hide()})}},window.ChatInput=i}(jQuery);var EDecorationAppType={10100:function(e){var t="";return 1==e.iType&&(t='<span class="admin-icon admin-icon-1"></span>'),2==e.iType&&(t='<span class="admin-icon admin-icon-0"></span>'),t},10200:function(){return""},10300:function(){var e="";return e},10400:function(e){var t="";return e.iBadgeLevel>0&&(t+='<span class="fans-level fans-level-'+e.iBadgeLevel+'" title="\u5fbd\u7ae0\u4e3b\u64ad\uff1a'+e.sPresenterNickName+'">'+e.sBadgeName+"</span>"),t}};window.liveRoomInstance=new PublicUI({target:$("#watchChat_pub"),chatInputConifg:{cfg:{target:$("#pub_msg_input"),sendButtonId:"msg_send_bt",tipsId:"pubNoticMe"}}}),function(){function e(e){var t;return function(){return t||(t=e.apply(this,arguments))}}function t(t){return e(function(){var e=$.Deferred();return HUYA_UTIL.getScript(t,function(){e.resolve()}),function(t){e.done(t)}})}function i(e){var t="",i={showSafetyVerifyPopupBox:"showPopupBox",closeSafetyVerifyPopupBox:"closePopupBox",setUsedClientCAMark:"safetyVerifyFlashCallSetUsedClient",isUsedClientCAMark:"safetyVerifyFlashCallIsUsedClient",isRemClientCAMark:"safetyVerifyFlashCallIsRemClient"};if(e&&(t=i[e.jsKey])){if(window.safetyVerifyUtil)return safetyVerifyUtil[t](e);$.getScript("https://res.udb.duowan.com/ca/js/extra/sdk/pcweb.js",function(){$.getScript("http://a.dwstatic.com/huya/icenter/2.0/js/safety-verify.js",function(){return safetyVerifyUtil[t](e)})})}}var n=1e4;TT.playerDisplayMode=0,TTP.on("pageFullScreen",function(e){var t=$("body");0==e.param.flag?t.removeClass("mode-page-full"):1==e.param.flag&&t.addClass("mode-page-full"),TT.playerDisplayMode=e.param.flag,TT.emit("playerDisplayModeChange",TT.playerDisplayMode)});var a=function(){var e=(6==hyPlayerConfig.iSourceType&&0==hyPlayerConfig.screenType||2==hyPlayerConfig.iSourceType)&&2168==hyPlayerConfig.liveRoomGid,i=e?"http://a.dwstatic.com/huya/main/js/room_common/giftWeekRank2_46927a0.js":"http://a.dwstatic.com/huya/main/js/room_common/giftWeekRank_2439269.js";return t(i)}();$(window).on("load",a),setTimeout(a,n),TTP.on("showWeekStarRank",function(){a()(function(){TT.emit("liveRoomWeekStarRank")})});var s=t("http://a.dwstatic.com/huya/main/js/room_common/guessReport_93db27c.js");$(window).on("load",s),setTimeout(s,n),TTP.on(TTP.isH5?"guessReport":"gameGuessReport",function(){s()(function(){TT.emit("liveRoomGuessReport")})}),HUYA_UTIL.getScript("http://a.dwstatic.com/huya/main/js/room_common/emot_e840717.js"),TTP.ready(function(){HUYA_UTIL.getScript("http://a.dwstatic.com/huya/main/js/room_common/watchHistory_87390b9.js")});var o=t("http://a.dwstatic.com/huya/main/js/room_common/vipCards_db71c89.js");$(window).on("load",o),setTimeout(o,n);var r=t("http://a.dwstatic.com/huya/main/js/room_common/getPrize_ba9f605.js");$(window).on("load",r),setTimeout(r,n),TTP.isH5?TTP.ready(function(e){e.addTafListener("7054",function(e){r()(function(){TT.emit("liveRoomGetPrize",{param:e})})})}):TTP.on("showRaffleWinnerNotice",function(e){r()(function(){TT.emit("liveRoomGetPrize",e)})});var l=t("http://a.dwstatic.com/huya/main/js/room_common/recharge_721fe4b.js");$(window).on("load",l),setTimeout(l,n),TTP.on("webgamepaylayer",function(e){l()(function(){TT.emit("liveRoomRecharge",e)})}),TT.on("liveRoom_recharge",function(e,t){NAV_UTIL.checkLogin(function(){l()(function(){TT.emit("liveRoomRecharge",t)})})}),TTP.on("webgamelivepay",function(e){if(window.pay_util)return pay_util.execute(e);var t=document.createElement("link");t.rel="stylesheet",t.href="https://res.duowan.com/pay/auth/web/style.css",document.getElementsByTagName("head")[0].appendChild(t),$.getScript("http://res.duowan.com/pay/auth/js/auth.js",function(){var t="http://a.dwstatic.com/huya/main/js/livepay_67aeb0b.js";$.getScript(t,function(){return pay_util.execute(e)})})});var c=t("http://a.dwstatic.com/huya/main/js/room_common/firstRecharge_06a03d2.js");$(window).on("load",c),setTimeout(c,n),TTP.on("getFirstRecharge",function(e){c()(function(){TT.emit("liveRoomFirstRecharge",e)})});var d=t("http://a.dwstatic.com/huya/main/js/room_common/topUpPayment_b6de9d2.js");$(window).on("load",d),setTimeout(d,n),TTP.on("topUpPayment",function(e){d()(function(){TT.emit("liveRoomTopUpPayment",e)})}),TTP.on("showSafetyVerifyPopupBox",i),TTP.on("closeSafetyVerifyPopupBox",i),TTP.on("setUsedClientCAMark",i),TTP.on("isUsedClientCAMark",i),TTP.on("isRemClientCAMark",i),TTP.on("playerError",function(){function e(){if(window.localStorage){var e=(new Date).getTime(),t=localStorage.getItem("h5ErrorTime");if(t&&864e5>=e-t)return!1;localStorage.setItem("h5ErrorTime",e)}}e();var t=window.location.href;t+=t.indexOf("?")>=0?"&playerflash=1":"?playerflash=1",window.location.href=t}),TTP.on("setGuid",function(e){var t=new Date;t.setTime(t.getTime()+2592e6),HUYA_UTIL.writeCookie("guid",e.param.guid,TT.domainForWriteCookie,"/",t)}),TTP.isFlash&&TTP.on("setFlashCookie",function(e){var t=new Date;t.setTime(t.getTime()+864e5),HUYA_UTIL.writeCookie(e.param.cookieKey,e.param.cookieVal,TT.domainForWriteCookie,"/",t)})}(),function(){function e(e){var t=e.param?e.param.data.total_count:e.data.total_count;if(t>0){var i=formatNumber(t,"#,###");$("#live-count").html(i)}}TTP.isH5?TTP.ready(function(t){t.addTafListener("8006",function(t){e({data:{total_count:t.iAttendeeCount}})})}):TTP.on("WebTotalCount",e)}(),function(){function e(e){var t=e.param?e.param:e;$("#activityCount").text(t.data?t.data.iToCount:t.iToCount)}TTP.isH5?TTP.ready(function(t){t.addTafListener("3104",e)}):TTP.on("subscribeInfoNotice",e)}(),function(){function e(){$(".notice-live").show()}TTP.isH5?TTP.ready(function(t){t.addTafListener("9010",e)}):TTP.on("noticeLive",e)}(),TTP.on("liveStatusChange",function(e){var t=e.param?e.param.status:e.status;TT.emit("liveStatusChange",t)}),TTP.on("webgamelivelogin",NAV_UTIL.login),TTP.isFlash&&TTP.on("isUserOnLive",function(e){1==e.param.isLive&&$("#tipsOrchat").css("visibility","visible").html('<div class="live-tips"><i></i><p>\u4e3a\u4fdd\u969c\u60a8\u7684\u76f4\u64ad\u4e0d\u88ab\u4e2d\u65ad\uff0c\u60a8\u6682\u65f6\u4e0d\u80fd\u5728\u7f51\u9875\u4e0a\u8fdb\u884c\u7ade\u731c\uff0c\u9001\u793c\u548c\u53d1\u8a00(\u76f4\u5230\u60a8\u7ed3\u675f\u76f4\u64ad),\u6211\u4eec\u5c06\u5c3d\u5feb\u89e3\u51b3\u3002</p></div>')});var liveListenObj={weekList:null,weekTpl:function(obj){function formatNumber(e,t){for(var i=e?e.toString().split("."):["0"],n=t?t.split("."):[""],a="",s=i[0],o=n[0],r=s.length-1,l=!1,c=o.length-1;c>=0;c--)switch(o.substr(c,1)){case"#":r>=0&&(a=s.substr(r--,1)+a);break;case"0":a=r>=0?s.substr(r--,1)+a:"0"+a;break;case",":l=!0,a=","+a}if(r>=0)if(l)for(var d=s.length;r>=0;r--)a=s.substr(r,1)+a,r>0&&(d-r)%3==0&&(a=","+a);else a=s.substr(0,r+1)+a;a+=".",s=i.length>1?i[1]:"",o=n.length>1?n[1]:"",r=0;for(var c=0;c<o.length;c++)switch(o.substr(c,1)){case"#":r<s.length&&(a+=s.substr(r++,1));break;case"0":a+=r<s.length?s.substr(r++,1):"0"}return a.replace(/^,+/,"").replace(/\.$/,"")}var __t,__p="";with(Array.prototype.join,obj||{}){__p+="";for(var len=Math.min(data.length,10),i=0;len>i;i++){var tip="";0==i?tip="num-one":1==i?tip="num-two":2==i&&(tip="num-three");var item=data[i],uid=item.lUid,iNobleLevel=item.iNobleLevel,sNickName=item.sNickName,iLevel=item.iUserLevel,beanNum=formatNumber(item.iScore,"#,###"),msgId="";try{msgId=window.liveRoomInstance.DJBHash(uid+"contributeWeekRank"),window.liveRoomInstance.msgCache[msgId]={uid:uid,nick:sNickName,msg:"\u5468\u8d21\u699c"}}catch(e){}__p+='\r\n        <li class="js-noble" data-lp="'+(null==(__t=uid)?"":__t)+'" data-id="'+(null==(__t=msgId)?"":__t)+'"><span class="item-num '+(null==(__t=tip)?"":__t)+'">'+(null==(__t=i+1)?"":__t)+"</span>\r\n\r\n            ",iNobleLevel>0&&(__p+='\r\n                <span class="noble-icon noble-level-'+(null==(__t=iNobleLevel)?"":__t)+'"></span>\r\n            '),__p+='\r\n\r\n            <span class="week-rank-name J_userMenu">'+(null==(__t=sNickName)?"":__t)+'</span>\r\n\r\n           \r\n            <span class="level-icon level-icon'+(null==(__t=iLevel)?"":__t)+'"></span>\r\n            \r\n\r\n            <span class="gold-num">'+(null==(__t=beanNum)?"":__t)+"<i></i></span>\r\n\r\n        </li>\r\n\r\n"}__p+="\r\n\r\n    ",data.length>3&&(__p+='\r\n        <li class="showMore">\u9001\u4e3b\u64ad\u793c\u7269\uff0c\u4e0a\u8d21\u732e\u699c</li>\r\n   '),__p+="\r\n\r\n"}return __p},weekRankListRefresh:function(e){if(this.weekList=e,$("#js-week-btn").hasClass("active")){if(e.param.data.lPid&&e.param.data.lPid!=window.l_p)return!1;var t=e.param.data.vWeekRankItem,i=$("#week-rank-list"),n='<div class="no-rank-tip">\u9001\u4e3b\u64ad\u793c\u7269\uff0c\u4e0a\u8d21\u732e\u699c</div>';t.length>0&&i.length&&(n=this.weekTpl({data:t})),i.html(n)}},fansList:null,fansTpl:function(obj){var __t,__p="";with(Array.prototype.join,obj||{}){__p+="";for(var len=Math.min(data.length,50),i=0;len>i;i++){var tip="";0==i?tip="num-one":1==i?tip="num-two":2==i&&(tip="num-three");var item=data[i],uid=item.lUid,iNobleLevel=item.iNobleLevel,iGuardLevel=item.iGuardianLevel,sNickName=item.sNickName,iLevel=item.iUserLevel,iBadgeLevel=item.iFansLevel,sBadgeName=item.sBadgeName,msgId="";try{msgId=window.liveRoomInstance.DJBHash(uid+"fansClub"),window.liveRoomInstance.msgCache[msgId]={uid:uid,nick:sNickName,msg:"\u7c89\u4e1d\u56e2"}}catch(e){}__p+='\r\n        <li class="js-noble" data-lp="'+(null==(__t=uid)?"":__t)+'" data-id="'+(null==(__t=msgId)?"":__t)+'">\r\n        \r\n            <span class="item-num '+(null==(__t=tip)?"":__t)+'">'+(null==(__t=i+1)?"":__t)+"</span>\r\n\r\n            ",iNobleLevel>0&&(__p+='\r\n                <span class="noble-icon noble-level-'+(null==(__t=iNobleLevel)?"":__t)+'"></span>\r\n            '),__p+='\r\n            <span class="week-rank-name J_userMenu">'+(null==(__t=sNickName)?"":__t)+'</span>\r\n\r\n            \r\n            <span class="level-icon level-icon'+(null==(__t=iLevel)?"":__t)+'"></span>\r\n            \r\n\r\n            ',""!=sBadgeName&&(__p+='\r\n                <span class="fans-wrap"><span class="fans-text">'+(null==(__t=sBadgeName)?"":__t)+"</span>"+(null==(__t=iBadgeLevel)?"":__t)+"</span>\r\n            "),__p+="\r\n\r\n            ",iGuardLevel>0&&(__p+='\r\n                <span class="sohu-wrap"><span class="sohu-icon"></span>'+(null==(__t=iGuardLevel)?"":__t)+"</span>\r\n            "),__p+="\r\n        </li>\r\n"}__p+="\r\n\r\n    ",data.length>3&&(__p+='\r\n        <li class="showMore">\u5b88\u62a4\u4e3b\u64ad\u6216\u62e5\u6709\u4e3b\u64ad\u7c89\u4e1d\u52cb\u7ae0\u53ef\u4e0a\u699c</li>\r\n   '),__p+="\r\n\r\n"}return __p},fansListRefresh:function(e){if(this.fansList=e,TT.log("#######\u7c89\u4e1d\u66f4\u65b0#############%o",e),$("#js-fans-btn").hasClass("active")){var t=$("#fans-list"),i=e,n='<div class="no-rank-tip">\u5b88\u62a4\u4e3b\u64ad\u6216\u62e5\u6709\u4e3b\u64ad\u7c89\u4e1d\u52cb\u7ae0\u53ef\u4e0a\u699c</div>';i.length>0&&t.length>0&&(n=this.fansTpl({data:i}));var a=t.data("jsp");a&&a.destroy(),$("#fans-list").html(n)}},createText:function(e,t,i,n){var a="";return e>0&&(a+='<span class="noble-icon noble-level-'+e+'"></span>'),a+=shouhuHtml(t),i>0&&(a+='<span class="fans-level fans-level-'+i+'">'+n+"</span>"),a},vipBarList:{param:{data:{vVipBarItem:[],iTotal:0}}},vipBarListReflesh:function(e){if(e.param.data.lPid&&e.param.data.lPid!=window.l_p)return!1;var t=e.param.data.vVipBarItem,i=$("#chat-current-peo"),n=$("[tab_index=4]");if(this.vipBarList=e,e.param.data.iTotal>0&&n.text("\u73b0\u573a\u8d35\u5bbe("+e.param.data.iTotal+")"),!n.hasClass("current"))return!1;if(t.length>0){for(var a="",s=0,o=t.length;o>s;s++){var r=t[s].lUid,l=t[s].tNobleInfo.iNobleLevel,c=t[s].tGuardInfo.iGuardLevel,d=t[s].tFansInfo.iBadgeLevel,u=e.param.data.sBadgeName;try{var f=decodeURIComponent(_.escape(t[s].sNickName))}catch(p){var f="\u89e3\u7801\u6709\u8bef"}var h="";try{h=window.liveRoomInstance.DJBHash(r+"vipSeats"),window.liveRoomInstance.msgCache[h]={uid:r,nick:f,msg:"\u8d35\u5bbe\u5e2d"}}catch(p){}a+='<li class="current-peo-item js-noble"  data-lp="'+r+'" data-id="'+h+'">',a+=this.createText(l,c,d,u),a+='<span class="peo-name J_userMenu">'+f+"</span></li>"}i.html(a),e.param.data.iTotal>100?$(".current-peo-foot").find("span").text("\u4f59\u4e0b"+(e.param.data.iTotal-100)+"\u4f4d\u8d35\u5bbe\u672a\u88ab\u5c55\u793a\uff0c\u5347\u7ea7\u8d35\u65cf\u6216\u5b88\u62a4\u53ef\u63d0\u5347\u6392\u540d").hide():$(".current-peo-foot").find("span").text(""),$(".chat-room__bd4").find(".chat-roomOther__scroll").jScrollPane({scrollbarWidth:8,mouseWheelSpeed:20})}},onNobleEnter:function(e){TT.log(e);var t=e.param?e.param:e,i=t.tNobleInfo.iNobleLevel;if(i>0){var n='<span class="box-noble-icon"></span>',a='<span class="name J_userMenu">'+t.sNickName+"</span>",s="",o={1:"http://a.dwstatic.com/huya/main/img/noble_enter/lv1_c891018.gif",2:"http://a.dwstatic.com/huya/main/img/noble_enter/lv2_24d176f.gif",3:"http://a.dwstatic.com/huya/main/img/noble_enter/lv3_ebbff79.gif",4:"http://a.dwstatic.com/huya/main/img/noble_enter/lv4_6357c6b.gif",5:"http://a.dwstatic.com/huya/main/img/noble_enter/lv5_edb6238.gif",6:"http://a.dwstatic.com/huya/main/img/noble_enter/lv6_cf93e85.gif"};s='<img class="noble-enter-pic" width="80" height="80" src="'+o[parseInt(i,10)]+'">';var r="";try{r=window.liveRoomInstance.DJBHash(t.lUid+"nobleEnterNotice"),window.liveRoomInstance.msgCache[r]={uid:t.lUid,nick:t.sNickName,msg:"\u8d35\u65cf\u5165\u573a\u901a\u77e5"}}catch(l){}this._addPubChatMsgQueue('<li data-id="'+r+'" class="box-noble-enter"><div class="noble-enter-wrap box-noble  box-noble-level-'+i+'"><p class="noble-enter-msg">'+a+' <span class="noble-enter-text">&nbsp;\u9a7e\u4e34\u76f4\u64ad\u95f4</span>'+s+"</p>"+n+"</div></li>")}},_addPubChatMsgQueue:function(e){window.liveRoomInstance&&window.liveRoomInstance.addPubChatMsgQueue(e)}};TTP.isH5?TTP.ready(function(e){e.addTafListener("6220",function(e){e.vWeekRankItem=e.vWeekRankItem.value,liveListenObj.weekRankListRefresh({param:{data:e}})})}):TTP.on("weekRankListRefresh",function(e){liveListenObj.weekRankListRefresh(e)}),TTP.isH5?TTP.ready(function(e){e.addTafListener("6223",function(e){liveListenObj.fansListRefresh(e.vFansSupportList.value)})}):TTP.on("getFansSupportListRsp",function(e){liveListenObj.fansListRefresh(e.param.vFansSupportList.value)}),TTP.isH5?TTP.ready(function(e){e.addTafListener("6210",function(e){e.vVipBarItem=e.vVipBarItem.value,liveListenObj.vipBarListReflesh({param:{data:e}})})}):TTP.on("vipBarListReflesh",function(e){liveListenObj.vipBarListReflesh(e)}),TTP.isH5?TTP.ready(function(e){e.addTafListener("6110",function(e){liveListenObj.onNobleEnter(e)})}):TTP.on("onNobleEnter",function(e){liveListenObj.onNobleEnter(e)});var liveBadgeObj={currentBadgeId:"",badgeList:[],currentBadge:{lUid:0,lBadgeId:0,sPresenterNickName:"",sBadgeName:"",iBadgeLevel:0,iRank:0,iScore:0,iNextScore:0,iQuotaUsed:0,iQuota:0,lQuotaTS:""},listDivObj:{},infoDivObj:{},NobleInfo:{},fansBadgeListHandler:function(e){var t=this;e=e.param?e.param:e;var i=e.vBadgeInfo;t.currentBadgeId=e.lUsingBadgeId,"undefined"!=typeof i&&"undefined"!=typeof i.value&&i.value.length>0?(t.badgeList=i.value,1==t.badgeList.length&&0!=t.currentBadgeId&&(t.currentBadge=t.badgeList[0]),t._initBadgeList(),t._initBadgeInfo(),0!=t.currentBadge.lBadgeId?$("#chatHostPic").addClass("host-pic-fans").removeClass("tips-trigger"):$("#chatHostPic").addClass("host-pic-fans_no").removeClass("host-pic-fans"),t._appendDiv(),t._setEvent()):($("#chatHostPic").removeClass("host-pic-fans").addClass("tips-trigger"),$("#fans-tip").remove(),t._initNoBadgeInfo(),$("#fans-tip").css("class","mod-tips-mini"))},useFansBadgeResp:function(e){if(e=e.param?e.param:e,"undefined"!=typeof e.lUid&&"undefined"!=typeof e.lBadgeId){for(var t=this,i=0;i<t.badgeList.length;i++)if(t.badgeList[i].lBadgeId==e.lBadgeId){t.currentBadgeId=e.lBadgeId,t.currentBadge=t.badgeList[i];break}0==e.lBadgeId&&(t.currentBadge={lUid:0,lBadgeId:0,sPresenterNickName:"",sBadgeName:"",iBadgeLevel:0,iRank:0,iScore:0,iNextScore:0,iQuotaUsed:0,iQuota:0,lQuotaTS:""}),t._updateBadge(t.currentBadge)}},fansBadgeUpNotice:function(e){var t=this;return e=e.param?e.param:e,1==e.iOverBadgeCountLimit?(t._tipMsg("\u4f60\u5df2\u7ecf\u62e5\u670920\u679a\u7c89\u4e1d\u5fbd\u7ae0\uff01\u5bf9\u5176\u4ed6\u4e3b\u64ad\u8d60\u9001\u793c\u7269\u4e0d\u589e\u52a0\u4eb2\u5bc6\u5ea6\u3002"),!1):(1==e.iBadgeLevelChanged&&(1==e.tBadgeInfo.iBadgeLevel?(t._tipMsg("\u606d\u559c\u4f60\u83b7\u5f97\u3010"+e.tBadgeInfo.sBadgeName+"\u3011\u7684\u7c89\u4e1d\u5fbd\u7ae0\uff01\u9001\u793c\u7269\u4f1a\u5347\u7ea7\u5594\uff01"),t._appendNewbadge(e.tBadgeInfo)):t._tipMsg("\u606d\u559c\u4f60\u62e5\u6709\u7684\u3010"+e.tBadgeInfo.sBadgeName+"\u3011\u7c89\u4e1d\u5fbd\u7ae0\u5347\u7ea7\u4e86\uff01\u7ee7\u7eed\u52a0\u6cb9\uff01")),t._updateBadge(e.tBadgeInfo),void(1==e.iBadgeLevelChanged&&1==e.tBadgeInfo.iBadgeLevel&&""==t.currentBadgeId&&t.getFansBadgeList(function(e){t.fansBadgeListHandler(e)})))},_updateBadge:function(e){if(DUYA_SUB.publish("updateFansBadge",e),e.lBadgeId>0){this.currentBadgeId==e.lBadgeId&&($("#chatHostPic").removeClass("host-pic-fans_no").addClass("host-pic-fans").html(e.sBadgeName),$("#badge-info").css("display","block"),$("#current-badge-anchor-level").html(e.sBadgeName).attr("class","fans-level fans-level-"+e.iBadgeLevel).attr("title",e.sBadgeName).show(),$("#current-badge-name1").html(e.sPresenterNickName).attr("title",e.sPresenterNickName).show(),$("#current-badge-score").html(e.iScore+"/"+e.iNextScore),$("#current-badge-progress").css({width:e.iScore/e.iNextScore*100+"%"}),$("#badge-rank").html(e.iRank),$("#badge-ul .menu-badge li").each(function(t,i){var n=$(i);n.attr("id")=="badge-id-"+e.lBadgeId?n.addClass("selected"):n.removeClass("selected")}),$("#current-badge-name2").html("["+e.sBadgeName+"]"),$("#current-badge-next-score").html(e.iNextScore-e.iScore));for(var t=0;t<this.badgeList.length;t++)if(this.badgeList[t].lBadgeId==e.lBadgeId){this.badgeList.splice(t,1,e);break}}else $("#chatHostPic").removeClass("host-pic-fans").addClass("host-pic-fans_no"),$("#chatHostPic").html(""),$("#current-badge-name1").html("\u672a\u4f69\u6234\u7c89\u4e1d\u5fbd\u7ae0"),$("#current-badge-anchor-level").hide(),$("#badge-info").css("display","none"),$(".badge-id-li a").removeClass("selected")},_appendNewbadge:function(e){var t="";t+='<li id="badge-id-'+e.lBadgeId+'" class="menu-badge-item" badgeid="'+e.lBadgeId+'">',t+='<span class="fans-level fans-level-'+e.iBadgeLevel+'" title="\u70b9\u51fb\u5207\u6362\u5fbd\u7ae0">'+e.sBadgeName+"</span>",t+='<span class="anchor-name" title="\u70b9\u51fb\u5207\u6362\u5fbd\u7ae0">'+e.sPresenterNickName+"</span>",t+='<i class="arrow-right"></i></li>',this.badgeList&&this.badgeList.push(e),$("#badge-ul").find(".menu-badge").append(t)
},_initBadgeInfo:function(){var e=this,t="",i=e.currentBadge.iScore/e.currentBadge.iNextScore*100+"%";0==e.currentBadgeId?(t+='<div id="badge-tip" class="chat-tips chat-badge-tips">',t+='<div class="chat-tips-bd" id="menu">',t+="<h3>\u6211\u7684\u5fbd\u7ae0</h3>",t+='<ul class="menu-badge">',t+='<li class="menu-badge-item">',t+='<span id="current-badge-anchor-level" class="fans-level" style="display:none"></span><span id="current-badge-name1" class="anchor-name">\u672a\u4f69\u6234\u7c89\u4e1d\u5fbd\u7ae0</span><i class="arrow-right"></i>',t+="</ul>",t+='<div class="menu-badge-affinity" id="badge-info" style="display:none;">',t+="<div>",t+='\u4eb2\u5bc6\u5ea6\uff1a<span class="progress" ><span id="current-badge-progress" class="progress-bar" style="width:'+i+'"></span><span id="current-badge-score" class="num">'+e.currentBadge.iScore+"/"+e.currentBadge.iNextScore+"</span></span>",t+='<span class="tooltips-badge">\u8d60\u9001\u793c\u7269\u53ef\u63d0\u5347\u4f60\u4e0e\u4e3b\u64ad\u7684\u4eb2\u5bc6\u5ea6\uff08\u6bcf\u65e5\u4eb2\u5bc6\u5ea6\u4e0a\u9650'+e.currentBadge.iQuota+'\uff09<br/>\u4f60\u4e0e<i id="current-badge-name2" class="tooltips-anchor">\uff3b'+e.currentBadge.sBadgeName+'\uff3d</i>\u8fd8\u9700\u8981<i id="current-badge-next-score" class="num">'+(e.currentBadge.iNextScore-e.currentBadge.iScore)+"</i>\u70b9\u4eb2\u5bc6\u5ea6\u5c31\u53ef\u5347\u5230\u4e0b\u4e00\u7b49\u7ea7\u3002</span>",t+="</div>",t+="<div>",t+='\u73b0\u5728\u662f\u7b2c<strong id="badge-rank">'+e.currentBadge.iRank+"</strong>\u540d",t+="</div>",t+="</div>",t+="</div>",t+='<i class="arrow-bottom"></i>',t+="</div>"):(t+='<div id="badge-tip" class="chat-tips chat-badge-tips">',t+='<div class="chat-tips-bd" id="menu">',t+="<h3>\u6211\u7684\u5fbd\u7ae0</h3>",t+='<ul class="menu-badge">',t+='<li class="menu-badge-item">',t+='<span id="current-badge-anchor-level" class="fans-level fans-level-'+e.currentBadge.iBadgeLevel+'">'+e.currentBadge.sBadgeName+'</span><span id="current-badge-name1" class="anchor-name">'+e.currentBadge.sPresenterNickName+'</span><i class="arrow-right"></i>',t+="</ul>",t+='<div class="menu-badge-affinity" id="badge-info">',t+="<div>",t+='\u4eb2\u5bc6\u5ea6\uff1a<span class="progress" ><span id="current-badge-progress" class="progress-bar" style="width:'+i+'"></span><span id="current-badge-score" class="num">'+e.currentBadge.iScore+"/"+e.currentBadge.iNextScore+"</span></span>",t+='<span class="tooltips-badge">\u8d60\u9001\u793c\u7269\u53ef\u63d0\u5347\u4f60\u4e0e\u4e3b\u64ad\u7684\u4eb2\u5bc6\u5ea6\uff08\u6bcf\u65e5\u4eb2\u5bc6\u5ea6\u4e0a\u9650'+e.currentBadge.iQuota+'\uff09<br/>\u4f60\u4e0e<i id="current-badge-name2" class="tooltips-anchor">\uff3b'+e.currentBadge.sBadgeName+'\uff3d</i>\u8fd8\u9700\u8981<i id="current-badge-next-score" class="num">'+(e.currentBadge.iNextScore-e.currentBadge.iScore)+"</i>\u70b9\u4eb2\u5bc6\u5ea6\u5c31\u53ef\u5347\u5230\u4e0b\u4e00\u7b49\u7ea7\u3002</span>",t+="</div>",t+="<div>",t+='\u73b0\u5728\u662f\u7b2c<strong id="badge-rank">'+e.currentBadge.iRank+"</strong>\u540d",t+="</div>",t+="</div>",t+="</div>",t+='<i class="arrow-bottom"></i>',t+="</div>"),e.infoDivObj=$(t),$("#chatHostPic").html(e.currentBadge.sBadgeName)},_initNoBadgeInfo:function(){var e='<div id="fans-tip" class="chat-tips chat-fans-tip"><div class="chat-tips-bd"><h3>\u7c89\u4e1d\u52cb\u7ae0</h3><p>\u7ed9\u5df2\u5f00\u901a\u7684\u4e3b\u64ad<i class="em">\u4e00\u6b21\u6027\u8d60\u900110\u4e2a\u5c0f\u793c\u7269</i>\u5373\u53ef\u62e5\u6709\u3002<br/>\u7acb\u5373\u8d60\u9001\uff0c\u66f4\u4f1a\u6bcf\u5929\u83b7\u5f97 \u514d\u8d39\u793c\u5305 \u5594\uff01<a href="http://live.yy.com/public/main/subject/fans/index.html" target="_blank">\u4e86\u89e3\u66f4\u591a&gt;&gt;</a></p></div><i class="arrow-bottom"></i></div>';$("#badge-tip").remove(),$("#badge-ul").remove(),$("#fans-tip").remove(),$("#chatHostPic,#fans-tip").off(),$("#chatHostPic").after($(e));var t=null;$("#chatHostPic,#fans-tip").mouseenter(function(){t&&clearTimeout(t),$("#fans-tip").stop().fadeIn(100)}).mouseleave(function(){t&&clearTimeout(t),t=setTimeout(function(){$("#fans-tip").stop().fadeOut(100)},500)})},_initBadgeList:function(){for(var e=this,t='<div id="badge-ul" class="chat-tips chat-subbadge-tips"><div class="chat-tips-bd"><div class="title"> <a href="http://i.huya.com/index.php?m=Badge" target="_blank">\u5fbd\u7ae0\u8be6\u60c5</a></div><ul class="menu-badge">',i=0;i<e.badgeList.length;i++){var n="";e.badgeList[i].lBadgeId==e.currentBadgeId&&(n=" selected",e.currentBadge=e.badgeList[i]),t+='<li id="badge-id-'+e.badgeList[i].lBadgeId+'" class="menu-badge-item'+n+'" badgeid="'+e.badgeList[i].lBadgeId+'">',t+='<span class="fans-level fans-level-'+e.badgeList[i].iBadgeLevel+'" title="\u70b9\u51fb\u5207\u6362\u5fbd\u7ae0">'+e.badgeList[i].sBadgeName+"</span>",t+='<span class="anchor-name" title="\u70b9\u51fb\u5207\u6362\u5fbd\u7ae0">'+e.badgeList[i].sPresenterNickName+"</span>",t+='<i class="arrow-right"></i></li>'}t+='</ul><div class="menu-badge-none" badgeid="0"><a href="javascript:void(0)" >\u4e0d\u7528\u4f69\u6234</a></div></div></div>',e.listDivObj=$(t)},_appendDiv:function(){var e=this;$("#fans-tip").remove(),$("#badge-tip").remove(),$("#badge-ul").remove(),$("#chatHostPic").off("mouseleave").off("mouseenter").after(e.listDivObj).after(e.infoDivObj)},_setEvent:function(){var e=null,t=null,i=null;$("#chatHostPic,#badge-tip").off(),$("#badge-info .progress").off(),$("#menu").off(),$("#badge-ul").off(),$("#chatHostPic,#badge-tip").mouseenter(function(){i&&clearTimeout(i),$("#badge-tip").stop().fadeIn(100)}).mouseleave(function(){i&&clearTimeout(i),i=setTimeout(function(){$("#badge-tip").stop().fadeOut(100)},200)}),$("#badge-info .progress").mouseenter(function(){e&&clearTimeout(e),e=setTimeout(function(){$("#badge-info .tooltips-badge").stop().fadeIn("fast")},500)}).mouseleave(function(){e&&clearTimeout(e),e=setTimeout(function(){$("#badge-info .tooltips-badge").stop().fadeOut("fast")},100)}),$("#menu").mouseenter(function(){t&&clearTimeout(t),$("#badge-ul").stop().fadeIn(100)}).mouseleave(function(){t&&clearTimeout(t),t=setTimeout(function(){$("#badge-ul").stop().fadeOut(100)},200)}),$("#badge-ul").mouseenter(function(){t&&clearTimeout(t),i&&clearTimeout(i)}).mouseleave(function(){t&&clearTimeout(t),i&&clearTimeout(i),i=setTimeout(function(){$("#badge-tip").stop().fadeOut(100)},200),t=setTimeout(function(){$("#badge-ul").stop().fadeOut(100)},200)}).on("click",".menu-badge-item",function(){var e=$(this),t=e.attr("badgeid");TTP.isH5?TTP.ready(function(e){e.addTafListener("useBadge",function(t){liveBadgeObj.useFansBadgeResp(t),e.removeTafListener("useBadge")});var i=new HUYA.BadgeReq;i.tUserId=e.userId,i.lBadgeId=t,e.sendWup("liveui","useBadge",i)}):(TTP.on("UseFansBadgeResp",function(e){liveBadgeObj.useFansBadgeResp(e)}),TTP.ready(function(e){e.callAs("UseFansBadgeReq",{lBadgeId:t})}))}).on("click",".menu-badge-none",function(){var e=$(this),t=e.attr("badgeid");$("#badge-ul .menu-badge-item").removeClass("selected"),TTP.isH5?TTP.ready(function(e){e.addTafListener("useBadge",function(t){liveBadgeObj.useFansBadgeResp(t),e.removeTafListener("useBadge")});var i=new HUYA.BadgeReq;i.tUserId=e.userId,i.lBadgeId=t,e.sendWup("liveui","useBadge",i)}):(TTP.on("UseFansBadgeResp",function(e){liveBadgeObj.useFansBadgeResp(e)}),TTP.ready(function(e){e.callAs("UseFansBadgeReq",{lBadgeId:t})}))})},_tipMsg:function(e){var t='<div id="fans-tip-msg" class="chat-tips chat-fans-tip"><div class="chat-tips-bd"><p>'+e+'<a onclick="$(\'#fans-tip-msg\').remove();" href="javascript:void(0)">\u6211\u77e5\u9053\u4e86</a></p></div><i class="arrow-bottom"></i></div>';$("#chatHostPic").after($(t)),$("#fans-tip-msg").css("display","block"),setTimeout(function(){$("#fans-tip-msg").remove()},3e3)},gameliveNobleInfo:function(e){var t=!1,e=e.param?e.param.tInfo:e.tInfo;(2==e.iNobleStatus||3==e.iNobleStatus)&&(t=!0),this.NobleInfo=e,this.NobleInfo.iNobleFlag=t},getFansBadgeList:function(e){TTP.isH5?TTP.ready(function(t){t.addTafListener("queryBadgeInfoList",function(i){e(i),t.removeTafListener("queryBadgeInfoList")});var i=new HUYA.BadgeInfoListReq;i.tUserId=t.userId,t.sendWup("liveui","queryBadgeInfoList",i)}):(TTP.on("GetFansBadgeListResp",function(t){e(t),TTP.off("GetFansBadgeListResp")}),TTP.ready(function(e){e.callAs("GetFansBadgeListReq")}))},init:function(){var e=this,t=!!HUYA_UTIL.getCookieVal("yyuid");t?(TTP.isH5?TTP.ready(function(t){t.addTafListener("6231",function(){e.getFansBadgeList(function(t){e.fansBadgeListHandler(t)}),t.removeTafListener("6231")})}):TTP.on("FansBadgeInfoNotice",function(){e.getFansBadgeList(function(t){e.fansBadgeListHandler(t)}),TTP.off("FansBadgeInfoNotice")}),TTP.isH5?TTP.ready(function(e){e.addTafListener("6232",function(e){liveBadgeObj.fansBadgeUpNotice(e)})}):TTP.on("FansBadgeUpNotice",function(e){liveBadgeObj.fansBadgeUpNotice(e)})):liveBadgeObj._initNoBadgeInfo()}};liveBadgeObj.init(),TTP.isH5?TTP.ready(function(e){e.addTafListener("GetNobleInfo",function(t){liveBadgeObj.gameliveNobleInfo(t),e.removeTafListener("GetNobleInfo")});var t=new HUYA.NobleInfoReq;t.tUserId=e.userId,e.sendWup("NobleServer","GetNobleInfo",t)}):TTP.on("gameliveNobleInfo",function(e){liveBadgeObj.gameliveNobleInfo(e)}),!function(){function e(e){this.state="READY",this.data=$.extend({},e),this.delay=this.data.delay,this.statechangeCallbacks=$.Callbacks(),this.statechange=function(e){this.statechangeCallbacks.add(e)},this.onCdCallbacks=$.Callbacks(),this.onCd=function(e){this.onCdCallbacks.add(e)}}function t(){d.find("img").attr("src","http://a.dwstatic.com/huya/main/img/room/treasure-chest/box_9de85e8.png"),d.find(".btn").removeClass("usable disable").text("loading"),d.show()}function i(i){var n=new e(i);return n.statechange(function(e){var i=d.find(".btn"),a=d.find("img"),s=d.find(".nick");"START"===e&&(s.text(r(n.data.senderNick)),t()),"CD"===e&&n.onCd(function(e){var t=Math.floor(e/60),n=e%60;i.text((10>t?"0":"")+t+":"+(10>n?"0":"")+n)}),"ING"===e&&(a.attr("src","http://a.dwstatic.com/huya/main/img/room/treasure-chest/box_3951e08.gif?"+(new Date).getTime()),i.addClass("usable").text("\u9886\u53d6"),i.on("click",function(e){e.preventDefault(),n.draw()})),"ED"===e&&i.removeClass("usable").addClass("disable").text("\u5df2\u9886\u53d6"),"END"==e&&f().dequeue()}),f().list[0]=n,n.start(),n}function n(e){var t=null;try{console.log("\u524d\u7aef: treasureUpdateNotice.iState:"+e.iState)}catch(n){}switch(e.iState){case 1:i({senderNick:e.sSendNick,delay:e.iCountDown});break;case 2:(t=f().list[0])&&t.end();break;case 3:f().enqueue(null)}}function a(e){try{console.log("\u524d\u7aef: queryTreasureInfoRsp.iQueneSize:"+e.iQueneSize)}catch(t){}if(u&&f().clear(),!(e.iQueneSize<=0)){for(;e.iQueneSize--;)f().enqueue(null);i({state:["","CD","ING","ED"][e.iStatus],delay:e.iCountDown,senderNick:e.sNickName})}}function s(e){if(e.iPrizeType<=0){var t=huya_layer({container:"#watchChat_pub",view:['<div class="treasureChest-tips">','<div class="tct-wrap">','<p class="tct-cont">\u624b\u6c14\u4e0d\u4f73\uff0c\u4f60\u6ca1\u6709\u9886\u53d6\u5230\u5956\u52b1~</p>',"</div>",0/0].join(""),lock:!1});return void setTimeout(function(){t.close()},3e3)}if(6==e.iPrizeType||9==e.iPrizeType||14==e.iPrizeType){var t=huya_layer({container:"#watchChat_pub",view:['<div class="treasureChest-tips">','<div class="tct-wrap">','<i class="tct-icon"></i>','<div class="tct-cont">','<p>\u606d\u559c\u4f60\u83b7\u5f97<em class="tct-prize">'+e.sPrizeName+"</em>\uff01</p>",'<p class="tct-ps">\u5956\u52b1\u5df2\u5b58\u5165'+(14==e.iPrizeType?'<a target="_blank" href="http://'+(l?"":"test.")+'i.huya.com/index.php?m=MyGift&do=listMyGift">\u6211\u7684\u798f\u5229</a>':"\u5305\u88f9")+"\u4e2d\uff0c\u5feb\u53bb\u67e5\u770b\u5427~</p>","</div>","</div>",'<a class="tct-x" href="#"></a>',0/0].join(""),lock:!1});t.view.find(".tct-x").on("click",function(e){e.preventDefault(),t.close()})}else{var t=huya_layer({container:"#watchChat_pub",view:['<div class="treasureChest-tips">','<div class="tct-wrap">','<i class="tct-icon"></i>','<p class="tct-cont">\u606d\u559c\u4f60\u83b7\u5f97<em class="tct-prize">'+e.sPrizeName+"</em>\uff01</p>","</div>",0/0].join(""),lock:!1});setTimeout(function(){t.close()},3e3)}}function o(e){var t=["<li>",'<div class="treasureChest-winningRecord">','<span class="treasureChest-winningRecord-user">'+r(e.sUserNick)+"</span>"," \u83b7\u5f97 ",'<span class="treasureChest-winningRecord-sender">'+r(e.sStarterNick)+"</span>"," \u6d3e\u9001\u7684 ",'<span class="treasureChest-winningRecord-prize">'+e.sPrizeName+"</span>","</div>","</li>"].join("");try{liveRoomInstance.addPubChatMsgQueue(t)}catch(i){}}function r(e){return"string"!=typeof e?e:e=e.replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\'/g,"&#39;").replace(/\"/g,"&quot;")}var l=TT.isProd;e.prototype={delay:180,duration:15,start:function(){var e=this;if("READY"===e.state)switch(e.state="START",e.statechangeCallbacks.fireWith(e,[e.state]),e.data.state){case"CD":e.countdown(e.delay);break;case"ING":e.open(e.duration);break;case"ED":e.ed();break;default:e.countdown(e.delay)}},countdown:function(e){var t=this;t.state="CD",t.statechangeCallbacks.fireWith(t,[t.state]);var i=e,n=e;t.onCdCallbacks.fireWith(t,[i,n]),t.cdInterval=setInterval(function(){i--,t.onCdCallbacks.fireWith(t,[i,n]),0>=i&&(clearInterval(t.cdInterval),t.open(t.duration))},1e3)},open:function(){var e=this;e.state="ING",e.statechangeCallbacks.fireWith(e,[e.state])},end:function(){var e=this;clearInterval(e.cdInterval),e.state="END",e.statechangeCallbacks.fireWith(e,[e.state])},ed:function(){var e=this;e.state="ED",e.statechangeCallbacks.fireWith(e,[e.state])},draw:function(){if(!NAV_UTIL.isLogin())return void NAV_UTIL.login();if("ING"===this.state){var e=this;TTP.ready(function(e){if(TTP.isH5){e.addTafListener("sendTreasureLotteryDraw",function(t){s(t),e.removeTafListener("sendTreasureLotteryDraw")});var t=new HUYA.TreasureLotteryDrawReq;$.extend(t,{tId:e.userId,sStarterNick:DUYA_INS.userNick,lSid:hyPlayerConfig.args.chTopId,lSubSid:hyPlayerConfig.args.subChId}),e.sendWup("liveui","sendTreasureLotteryDraw",t)}else TTP.on("treasureLotteryDrawRsp",function(e){s(e.param),TTP.off("treasureLotteryDrawRsp")}),e.callAs("treasureLotteryDrawReq")}),e.ed()}}};var c=function(){this.list=[],this.size=0,this.changeCallbacks=$.Callbacks(),this.change=function(e){this.changeCallbacks.add(e)}};c.prototype.enqueue=function(e){this.list.push(e),this.size+=1,this.changeCallbacks.fireWith(this,[1,e])},c.prototype.dequeue=function(){if(!(this.size<=0)){var e=this.list.shift();this.size-=1,this.changeCallbacks.fireWith(this,[0,e])}},c.prototype.clear=function(){var e=this.list;this.list=[],this.size=0,this.changeCallbacks.fireWith(this,[-1,e])};var d=null,u=!1,f=function(){var e=null;return function(){return e||(u=!0,e=new c,d=$('<div class="liveRoom_treasureChest"><span class="box"><img src="http://a.dwstatic.com/huya/main/img/room/treasure-chest/box_9de85e8.png" alt="\u5b9d\u7bb1" /></span><i class="num"></i><p class="btn-wrap"><span class="btn">loading</span></p><div class="waitTips"><p class="tit"><span class="nick">\u571f\u8c6a</span>\u7684\u85cf\u5b9d\u56fe</p><div class="cont"><p>\u9886\u53d6\u8fd8\u672a\u5f00\u59cb\uff0c\u8bf7\u8010\u5fc3\u7b49\u5f85~</p><p>\u591a\u53d1\u5f39\u5e55\u53ef\u63d0\u9ad8\u4e2d\u5956\u6982\u7387\u54e6\uff01</p></div><i class="arrow"></i></div></div>'),d.on("mouseenter",function(){var e=f().list[0];e&&"CD"===e.state&&d.find(".waitTips").show()}).on("mouseleave",function(){d.find(".waitTips").hide()}),$("#watchChat_pub").append(d),e.change(function(i,n){var a=d.find(".num");a.text(this.size)[this.size>1?"show":"hide"](),1===i&&1===this.size&&t(),0===i&&(this.size>0?t():d.hide(500)),-1===i&&(n[0]&&n[0].end(),d.remove(),e=null,u=!1)})),e}}();TTP.isH5?TTP.ready(function(e){e.addTafListener("queryTreasure",a);var t=new HUYA.QueryTreasureInfoReq;$.extend(t,{tId:e.userId,lSid:hyPlayerConfig.args.chTopId,lSubSid:hyPlayerConfig.args.subChId}),e.sendWup("liveui","queryTreasure",t)}):TTP.on("queryTreasureInfoRsp",function(e){a(e.param)},!0),TTP.isH5?TTP.ready(function(e){e.addTafListener("6604",n)}):TTP.on("treasureUpdateNotice",function(e){n(e.param)}),TTP.isH5?TTP.ready(function(e){e.addTafListener("6605",o)}):TTP.on("treasureLotteryResultNotice",function(e){o(e.param)})}(),HUYA_UTIL.getScript("http://a.dwstatic.com/huya/main/js/room_common/gift_56d0e38.js"),HUYA_UTIL.getScript("http://a.dwstatic.com/huya/main/js/room_common/hd/dec_9c32ce2.js");